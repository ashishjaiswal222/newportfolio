"use strict";var An=Object.create;var ue=Object.defineProperty;var Un=Object.getOwnPropertyDescriptor;var Gn=Object.getOwnPropertyNames;var zn=Object.getPrototypeOf,Wn=Object.prototype.hasOwnProperty;var Re=e=>{throw TypeError(e)};var qn=(e,t,n)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $n=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Gn(t))!Wn.call(e,r)&&r!==n&&ue(e,r,{get:()=>t[r],enumerable:!(o=Un(t,r))||o.enumerable});return e};var _e=(e,t,n)=>(n=e!=null?An(zn(e)):{},$n(t||!e||!e.__esModule?ue(n,"default",{value:e,enumerable:!0}):n,e));var j=(e,t,n)=>qn(e,typeof t!="symbol"?t+"":t,n),Kn=(e,t,n)=>t.has(e)||Re("Cannot "+n);var Ie=(e,t,n)=>t.has(e)?Re("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);var me=(e,t,n)=>(Kn(e,t,"access private method"),n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("react"),l=require("react/jsx-runtime"),S=require("@floating-ui/react"),h=require("@blocknote/core"),A=require("react-dom"),Z=require("@tiptap/react"),Xn=require("react-dom/client"),Yn=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},E=Yn(a),pe=a.createContext(void 0);function R(e){return a.useContext(pe)}function x(e){const t=R();if(!(t!=null&&t.editor))throw new Error("useBlockNoteEditor was called outside of a BlockNoteContext provider or BlockNoteView component");return t.editor}function W(e,t,n){const o=R();t||(t=o==null?void 0:o.editor),a.useEffect(()=>{if(!t)throw new Error("'editor' is required, either from BlockNoteContext or as a function argument");return t.onSelectionChange(e,n)},[e,t,n])}function $e(e,t){const n=x();t=t||n;const[o,r]=a.useState(()=>{if(e)return t.getSelectionBoundingBox()}),i=a.useCallback(()=>{if(!e)return;const s=t.getSelectionBoundingBox();r(s)},[t,e]);return W(i,t,!0),a.useEffect(()=>{r(e?t.getSelectionBoundingBox():void 0)},[e,t]),o}function Jn(e){return e.getBoundingClientRect!==void 0}function N(e,t,n,o){const{refs:r,update:i,context:s,floatingStyles:d,isPositioned:u}=S.useFloating({open:e,...o}),{isMounted:c,styles:m}=S.useTransitionStyles(s),g=typeof(o==null?void 0:o.canDismiss)=="object"?o.canDismiss:{enabled:o==null?void 0:o.canDismiss},f=S.useDismiss(s,g),{getReferenceProps:b,getFloatingProps:w}=S.useInteractions([f]);return a.useEffect(()=>{i()},[t,i]),a.useEffect(()=>{t!==null&&(t instanceof HTMLElement||Jn(t)?r.setReference(t):r.setReference({getBoundingClientRect:()=>t}))},[t,r]),a.useMemo(()=>({isMounted:c,ref:r.setFloating,setReference:r.setReference,style:{display:"flex",...m,...d,zIndex:n},getFloatingProps:w,getReferenceProps:b,isPositioned:u}),[u,d,c,r.setFloating,r.setReference,m,n,w,b])}function L(e){const[t,n]=a.useState();return a.useEffect(()=>e(o=>{n({...o})}),[e]),t}const Ke=a.createContext(void 0);function p(){return a.useContext(Ke)}const q=(e={},t=[])=>a.useMemo(()=>{const n=h.BlockNoteEditor.create(e);return window&&(window.ProseMirror=n._tiptapEditor),n},t),Qn=q;function v(){return R().editor.dictionary}function U(e,t){const n=R();t||(t=n==null?void 0:n.editor),a.useEffect(()=>{if(!t)throw new Error("'editor' is required, either from BlockNoteContext or as a function argument");return t.onChange(e)},[e,t])}const ke=e=>{const[t,n]=a.useState(!1),[o,r]=a.useState(e.editor.isEmpty),i=p();U(()=>{r(e.editor.isEmpty)},e.editor);const s=a.useCallback(()=>{n(!0)},[]),d=a.useCallback(()=>{n(!1)},[]);return a.useEffect(()=>{e.editable&&e.autoFocus&&e.editor.focus()},[e.autoFocus,e.editable,e.editor]),l.jsxs(l.Fragment,{children:[l.jsx(i.Comments.Editor,{autoFocus:e.autoFocus,className:"bn-comment-editor",editor:e.editor,onFocus:s,onBlur:d,editable:e.editable}),e.actions&&l.jsx("div",{className:"bn-comment-actions-wrapper",children:l.jsx(e.actions,{isFocused:t,isEmpty:o})})]})},eo=h.createBlockSpecFromStronglyTypedTiptapNode(h.createStronglyTypedTiptapNode(h.defaultBlockSpecs.paragraph.implementation.node.config),{}),{textColor:Dl,backgroundColor:Zl,...to}=h.defaultStyleSpecs,we=h.BlockNoteSchema.create({blockSpecs:{paragraph:eo},styleSpecs:to});function Xe(){const e=x();if(!e.comments)throw new Error("Comments plugin not found");const t=e.comments,n=p(),o=v(),r=q({trailingBlock:!1,dictionary:{...o,placeholders:{emptyDocument:o.placeholders.new_comment}},schema:we});return l.jsx(n.Comments.Card,{className:"bn-thread",children:l.jsx(ke,{autoFocus:!0,editable:!0,editor:r,actions:({isEmpty:i})=>l.jsx(n.Generic.Toolbar.Root,{className:h.mergeCSSClasses("bn-action-toolbar","bn-comment-actions"),variant:"action-toolbar",children:l.jsx(n.Generic.Toolbar.Button,{className:"bn-button",mainTooltip:"Save",variant:"compact",isDisabled:i,onClick:async()=>{await t.createThread({initialComment:{body:r.document}}),t.stopPendingComment()},children:"Save"})})})})}const Ye=e=>{const t=x();if(!t.comments)throw new Error("FloatingComposerController can only be used when BlockNote editor has enabled comments");const n=t.comments;a.useEffect(()=>{const m=n.onUpdate(g=>t.setForceSelectionVisible(g.pendingComment));return()=>m()},[n,t]);const o=L(n.onUpdate.bind(n)),r=$e(o==null?void 0:o.pendingComment),{isMounted:i,ref:s,style:d,getFloatingProps:u}=N((o==null?void 0:o.pendingComment)||!1,r||null,5e3,{placement:"bottom",middleware:[S.offset(10),S.shift(),S.flip()],onOpenChange:m=>{m||(n.stopPendingComment(),t.focus())},...e.floatingOptions});if(!i||!o)return null;const c=e.floatingComposer||Xe;return l.jsx("div",{ref:s,style:d,...u(),children:l.jsx(c,{})})};var Je={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Ne=E.default.createContext&&E.default.createContext(Je),no=["attr","size","title"];function oo(e,t){if(e==null)return{};var n=lo(e,t),o,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function lo(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ee.apply(this,arguments)}function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,o)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fe(Object(n),!0).forEach(function(o){ro(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function ro(e,t,n){return t=io(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function io(e){var t=so(e,"string");return typeof t=="symbol"?t:t+""}function so(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Qe(e){return e&&e.map((t,n)=>E.default.createElement(t.tag,te({key:n},t.attr),Qe(t.child)))}function k(e){return t=>E.default.createElement(co,ee({attr:te({},e.attr)},t),Qe(e.child))}function co(e){var t=n=>{var{attr:o,size:r,title:i}=e,s=oo(e,no),d=r||n.size||"1em",u;return n.className&&(u=n.className),e.className&&(u=(u?u+" ":"")+e.className),E.default.createElement("svg",ee({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,o,s,{className:u,style:te(te({color:e.color||n.color},n.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),i&&E.default.createElement("title",null,i),e.children)};return Ne!==void 0?E.default.createElement(Ne.Consumer,null,n=>t(n)):t(Je)}function ao(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 7V11L2 6L8 1V5H13C17.4183 5 21 8.58172 21 13C21 17.4183 17.4183 21 13 21H4V19H13C16.3137 19 19 16.3137 19 13C19 9.68629 16.3137 7 13 7H8Z"},child:[]}]})(e)}function et(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M7.29117 20.8242L2 22L3.17581 16.7088C2.42544 15.3056 2 13.7025 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C10.2975 22 8.6944 21.5746 7.29117 20.8242ZM7.58075 18.711L8.23428 19.0605C9.38248 19.6745 10.6655 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 13.3345 4.32549 14.6175 4.93949 15.7657L5.28896 16.4192L4.63416 19.3658L7.58075 18.711Z"},child:[]}]})(e)}function uo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M7.24264 17.9967H3V13.754L14.435 2.319C14.8256 1.92848 15.4587 1.92848 15.8492 2.319L18.6777 5.14743C19.0682 5.53795 19.0682 6.17112 18.6777 6.56164L7.24264 17.9967ZM3 19.9967H21V21.9967H3V19.9967Z"},child:[]}]})(e)}function mo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M23 12L15.9289 19.0711L14.5147 17.6569L20.1716 12L14.5147 6.34317L15.9289 4.92896L23 12ZM3.82843 12L9.48528 17.6569L8.07107 19.0711L1 12L8.07107 4.92896L9.48528 6.34317L3.82843 12Z"},child:[]}]})(e)}function ve(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 8L9.00319 2H19.9978C20.5513 2 21 2.45531 21 2.9918V21.0082C21 21.556 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5501 3 20.9932V8ZM10 4V9H5V20H19V4H10Z"},child:[]}]})(e)}function fo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM5 19H19V21H5V19ZM3 14H21V16H3V14ZM5 9H19V11H5V9Z"},child:[]}]})(e)}function go(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM3 14H21V16H3V14ZM3 9H21V11H3V9Z"},child:[]}]})(e)}function ho(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H17V21H3V19ZM3 14H21V16H3V14ZM3 9H17V11H3V9Z"},child:[]}]})(e)}function bo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM7 19H21V21H7V19ZM3 14H21V16H3V14ZM7 9H21V11H7V9Z"},child:[]}]})(e)}function Co(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 11H12.5C13.8807 11 15 9.88071 15 8.5C15 7.11929 13.8807 6 12.5 6H8V11ZM18 15.5C18 17.9853 15.9853 20 13.5 20H6V4H12.5C14.9853 4 17 6.01472 17 8.5C17 9.70431 16.5269 10.7981 15.7564 11.6058C17.0979 12.3847 18 13.837 18 15.5ZM8 13V18H13.5C14.8807 18 16 16.8807 16 15.5C16 14.1193 14.8807 13 13.5 13H8Z"},child:[]}]})(e)}function xo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3.41436 5.99995L5.70726 3.70706L4.29304 2.29285L0.585938 5.99995L4.29304 9.70706L5.70726 8.29285L3.41436 5.99995ZM9.58594 5.99995L7.29304 3.70706L8.70726 2.29285L12.4144 5.99995L8.70726 9.70706L7.29304 8.29285L9.58594 5.99995ZM14.0002 2.99995H21.0002C21.5524 2.99995 22.0002 3.44767 22.0002 3.99995V20C22.0002 20.5522 21.5524 21 21.0002 21H3.00015C2.44787 21 2.00015 20.5522 2.00015 20V12H4.00015V19H20.0002V4.99995H14.0002V2.99995Z"},child:[]}]})(e)}function Pe(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5.55397 22H3.3999L10.9999 3H12.9999L20.5999 22H18.4458L16.0458 16H7.95397L5.55397 22ZM8.75397 14H15.2458L11.9999 5.88517L8.75397 14Z"},child:[]}]})(e)}function ne(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13 20H11V13H4V20H2V4H4V11H11V4H13V20ZM21.0005 8V20H19.0005L19 10.204L17 10.74V8.67L19.5005 8H21.0005Z"},child:[]}]})(e)}function oe(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 4V11H11V4H13V20H11V13H4V20H2V4H4ZM18.5 8C20.5711 8 22.25 9.67893 22.25 11.75C22.25 12.6074 21.9623 13.3976 21.4781 14.0292L21.3302 14.2102L18.0343 18H22V20H15L14.9993 18.444L19.8207 12.8981C20.0881 12.5908 20.25 12.1893 20.25 11.75C20.25 10.7835 19.4665 10 18.5 10C17.5818 10 16.8288 10.7071 16.7558 11.6065L16.75 11.75H14.75C14.75 9.67893 16.4289 8 18.5 8Z"},child:[]}]})(e)}function le(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M22 8L21.9984 10L19.4934 12.883C21.0823 13.3184 22.25 14.7728 22.25 16.5C22.25 18.5711 20.5711 20.25 18.5 20.25C16.674 20.25 15.1528 18.9449 14.8184 17.2166L16.7821 16.8352C16.9384 17.6413 17.6481 18.25 18.5 18.25C19.4665 18.25 20.25 17.4665 20.25 16.5C20.25 15.5335 19.4665 14.75 18.5 14.75C18.214 14.75 17.944 14.8186 17.7056 14.9403L16.3992 13.3932L19.3484 10H15V8H22ZM4 4V11H11V4H13V20H11V13H4V20H2V4H4Z"},child:[]}]})(e)}function tt(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13 20H11V13H4V20H2V4H4V11H11V4H13V20ZM22 8V16H23.5V18H22V20H20V18H14.5V16.66L19.5 8H22ZM20 11.133L17.19 16H20V11.133Z"},child:[]}]})(e)}function nt(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M22 8V10H17.6769L17.2126 12.6358C17.5435 12.5472 17.8912 12.5 18.25 12.5C20.4591 12.5 22.25 14.2909 22.25 16.5C22.25 18.7091 20.4591 20.5 18.25 20.5C16.4233 20.5 14.8827 19.2756 14.4039 17.6027L16.3271 17.0519C16.5667 17.8881 17.3369 18.5 18.25 18.5C19.3546 18.5 20.25 17.6046 20.25 16.5C20.25 15.3954 19.3546 14.5 18.25 14.5C17.6194 14.5 17.057 14.7918 16.6904 15.2478L14.8803 14.3439L16 8H22ZM4 4V11H11V4H13V20H11V13H4V20H2V4H4Z"},child:[]}]})(e)}function ot(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M21.097 8L18.499 12.5C20.7091 12.5 22.5 14.2909 22.5 16.5C22.5 18.7091 20.7091 20.5 18.5 20.5C16.2909 20.5 14.5 18.7091 14.5 16.5C14.5 15.7636 14.699 15.0737 15.0461 14.4811L18.788 8H21.097ZM4 4V11H11V4H13V20H11V13H4V20H2V4H4ZM18.5 14.5C17.3954 14.5 16.5 15.3954 16.5 16.5C16.5 17.6046 17.3954 18.5 18.5 18.5C19.6046 18.5 20.5 17.6046 20.5 16.5C20.5 15.3954 19.6046 14.5 18.5 14.5Z"},child:[]}]})(e)}function po(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM3 12.5L7 9V16L3 12.5Z"},child:[]}]})(e)}function ko(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM7 12.5L3 16V9L7 12.5Z"},child:[]}]})(e)}function De(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 5H11V19H8V21H16V19H13V5H16V3H8V5ZM2 7C1.44772 7 1 7.44772 1 8V16C1 16.5523 1.44772 17 2 17H8V15H3V9H8V7H2ZM16 9H21V15H16V17H22C22.5523 17 23 16.5523 23 16V8C23 7.44772 22.5523 7 22 7H16V9Z"},child:[]}]})(e)}function wo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M15 20H7V18H9.92661L12.0425 6H9V4H17V6H14.0734L11.9575 18H15V20Z"},child:[]}]})(e)}function vo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 17H22V19H19V22H17V17ZM7 7H2V5H5V2H7V7ZM18.364 15.5355L16.9497 14.1213L18.364 12.7071C20.3166 10.7545 20.3166 7.58866 18.364 5.63604C16.4113 3.68342 13.2455 3.68342 11.2929 5.63604L9.87868 7.05025L8.46447 5.63604L9.87868 4.22183C12.6123 1.48816 17.0445 1.48816 19.7782 4.22183C22.5118 6.9555 22.5118 11.3877 19.7782 14.1213L18.364 15.5355ZM15.5355 18.364L14.1213 19.7782C11.3877 22.5118 6.9555 22.5118 4.22183 19.7782C1.48816 17.0445 1.48816 12.6123 4.22183 9.87868L5.63604 8.46447L7.05025 9.87868L5.63604 11.2929C3.68342 13.2455 3.68342 16.4113 5.63604 18.364C7.58866 20.3166 10.7545 20.3166 12.7071 18.364L14.1213 16.9497L15.5355 18.364ZM14.8284 7.75736L16.2426 9.17157L9.17157 16.2426L7.75736 14.8284L14.8284 7.75736Z"},child:[]}]})(e)}function lt(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.3638 15.5355L16.9496 14.1213L18.3638 12.7071C20.3164 10.7545 20.3164 7.58866 18.3638 5.63604C16.4112 3.68341 13.2453 3.68341 11.2927 5.63604L9.87849 7.05025L8.46428 5.63604L9.87849 4.22182C12.6122 1.48815 17.0443 1.48815 19.778 4.22182C22.5117 6.95549 22.5117 11.3876 19.778 14.1213L18.3638 15.5355ZM15.5353 18.364L14.1211 19.7782C11.3875 22.5118 6.95531 22.5118 4.22164 19.7782C1.48797 17.0445 1.48797 12.6123 4.22164 9.87868L5.63585 8.46446L7.05007 9.87868L5.63585 11.2929C3.68323 13.2455 3.68323 16.4113 5.63585 18.364C7.58847 20.3166 10.7543 20.3166 12.7069 18.364L14.1211 16.9497L15.5353 18.364ZM14.8282 7.75736L16.2425 9.17157L9.17139 16.2426L7.75717 14.8284L14.8282 7.75736Z"},child:[]}]})(e)}function rt(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8.00008 6V9H5.00008V6H8.00008ZM3.00008 4V11H10.0001V4H3.00008ZM13.0001 4H21.0001V6H13.0001V4ZM13.0001 11H21.0001V13H13.0001V11ZM13.0001 18H21.0001V20H13.0001V18ZM10.7072 16.2071L9.29297 14.7929L6.00008 18.0858L4.20718 16.2929L2.79297 17.7071L6.00008 20.9142L10.7072 16.2071Z"},child:[]}]})(e)}function it(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 4H21V6H8V4ZM5 3V6H6V7H3V6H4V4H3V3H5ZM3 14V11.5H5V11H3V10H6V12.5H4V13H6V14H3ZM5 19.5H3V18.5H5V18H3V17H6V21H3V20H5V19.5ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z"},child:[]}]})(e)}function st(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 4H21V6H8V4ZM4.5 6.5C3.67157 6.5 3 5.82843 3 5C3 4.17157 3.67157 3.5 4.5 3.5C5.32843 3.5 6 4.17157 6 5C6 5.82843 5.32843 6.5 4.5 6.5ZM4.5 13.5C3.67157 13.5 3 12.8284 3 12C3 11.1716 3.67157 10.5 4.5 10.5C5.32843 10.5 6 11.1716 6 12C6 12.8284 5.32843 13.5 4.5 13.5ZM4.5 20.4C3.67157 20.4 3 19.7284 3 18.9C3 18.0716 3.67157 17.4 4.5 17.4C5.32843 17.4 6 18.0716 6 18.9C6 19.7284 5.32843 20.4 4.5 20.4ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z"},child:[]}]})(e)}function Ho(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M20 3C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H20ZM11 5H5V10.999H7V9L10 12L7 15V13H5V19H11V17H13V19H19V13H17V15L14 12L17 9V10.999H19V5H13V7H11V5ZM13 13V15H11V13H13ZM13 9V11H11V9H13Z"},child:[]}]})(e)}function Mo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M21 20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H20C20.5523 3 21 3.44772 21 4V20ZM19 11V5H13.001V7H15L12 10L9 7H11V5H5V11H7V13H5V19H11V17H9L12 14L15 17H13.001V19H19V13H17V11H19ZM11 13H9V11H11V13ZM15 13H13V11H15V13Z"},child:[]}]})(e)}function ct(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M21 4H3V6H21V4ZM21 11H8V13H21V11ZM21 18H8V20H21V18ZM5 11H3V20H5V11Z"},child:[]}]})(e)}function So(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17.1538 14C17.3846 14.5161 17.5 15.0893 17.5 15.7196C17.5 17.0625 16.9762 18.1116 15.9286 18.867C14.8809 19.6223 13.4335 20 11.5862 20C9.94674 20 8.32335 19.6185 6.71592 18.8555V16.6009C8.23538 17.4783 9.7908 17.917 11.3822 17.917C13.9333 17.917 15.2128 17.1846 15.2208 15.7196C15.2208 15.0939 15.0049 14.5598 14.5731 14.1173C14.5339 14.0772 14.4939 14.0381 14.4531 14H3V12H21V14H17.1538ZM13.076 11H7.62908C7.4566 10.8433 7.29616 10.6692 7.14776 10.4778C6.71592 9.92084 6.5 9.24559 6.5 8.45207C6.5 7.21602 6.96583 6.165 7.89749 5.299C8.82916 4.43299 10.2706 4 12.2219 4C13.6934 4 15.1009 4.32808 16.4444 4.98426V7.13591C15.2448 6.44921 13.9293 6.10587 12.4978 6.10587C10.0187 6.10587 8.77917 6.88793 8.77917 8.45207C8.77917 8.87172 8.99709 9.23796 9.43293 9.55079C9.86878 9.86362 10.4066 10.1135 11.0463 10.3004C11.6665 10.4816 12.3431 10.7148 13.076 11H13.076Z"},child:[]}]})(e)}function Bo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13 10V14H19V10H13ZM11 10H5V14H11V10ZM13 19H19V16H13V19ZM11 19V16H5V19H11ZM13 5V8H19V5H13ZM11 5H5V8H11V5ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3Z"},child:[]}]})(e)}function He(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13 6V21H11V6H5V4H19V6H13Z"},child:[]}]})(e)}function jo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 3V12C8 14.2091 9.79086 16 12 16C14.2091 16 16 14.2091 16 12V3H18V12C18 15.3137 15.3137 18 12 18C8.68629 18 6 15.3137 6 12V3H8ZM4 20H20V22H4V20Z"},child:[]}]})(e)}function yo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M2 3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44495 22 3.9934V20.0066C22 20.5552 21.5447 21 21.0082 21H2.9918C2.44405 21 2 20.5551 2 20.0066V3.9934ZM8 5V19H16V5H8ZM4 5V7H6V5H4ZM18 5V7H20V5H18ZM4 9V11H6V9H4ZM18 9V11H20V9H18ZM4 13V15H6V13H4ZM18 13V15H20V13H18ZM4 17V19H6V17H4ZM18 17V19H20V17H18Z"},child:[]}]})(e)}function at(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"},child:[]}]})(e)}function To(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M21 15V18H24V20H21V23H19V20H16V18H19V15H21ZM21.0082 3C21.556 3 22 3.44495 22 3.9934L22.0007 13.3417C21.3749 13.1204 20.7015 13 20 13V5H4L4.001 19L13.2929 9.70715C13.6528 9.34604 14.22 9.31823 14.6123 9.62322L14.7065 9.70772L18.2521 13.2586C15.791 14.0069 14 16.2943 14 19C14 19.7015 14.1204 20.3749 14.3417 21.0007L2.9918 21C2.44405 21 2 20.5551 2 20.0066V3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082ZM8 7C9.10457 7 10 7.89543 10 9C10 10.1046 9.10457 11 8 11C6.89543 11 6 10.1046 6 9C6 7.89543 6.89543 7 8 7Z"},child:[]}]})(e)}function Vo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M20 3C20.5523 3 21 3.44772 21 4V5.757L19 7.757V5H5V13.1L9 9.1005L13.328 13.429L12.0012 14.7562L11.995 18.995L16.2414 19.0012L17.571 17.671L18.8995 19H19V16.242L21 14.242V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H20ZM21.7782 7.80761L23.1924 9.22183L15.4142 17L13.9979 16.9979L14 15.5858L21.7782 7.80761ZM15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7Z"},child:[]}]})(e)}function dt(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M22 18V20H2V18H22ZM2 3.5L10 8.5L2 13.5V3.5ZM22 11V13H12V11H22ZM22 4V6H12V4H22Z"},child:[]}]})(e)}function Lo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 3.9934C3 3.44476 3.44495 3 3.9934 3H20.0066C20.5552 3 21 3.44495 21 3.9934V20.0066C21 20.5552 20.5551 21 20.0066 21H3.9934C3.44476 21 3 20.5551 3 20.0066V3.9934ZM10.6219 8.41459C10.5562 8.37078 10.479 8.34741 10.4 8.34741C10.1791 8.34741 10 8.52649 10 8.74741V15.2526C10 15.3316 10.0234 15.4088 10.0672 15.4745C10.1897 15.6583 10.4381 15.708 10.6219 15.5854L15.5008 12.3328C15.5447 12.3035 15.5824 12.2658 15.6117 12.2219C15.7343 12.0381 15.6846 11.7897 15.5008 11.6672L10.6219 8.41459Z"},child:[]}]})(e)}function ut(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"},child:[]}]})(e)}function Eo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"},child:[]}]})(e)}function Ro(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"},child:[]}]})(e)}function _o(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8ZM9 4V6H15V4H9Z"},child:[]}]})(e)}function Io(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM9 11V17H11V11H9ZM13 11V17H15V11H13ZM9 4V6H15V4H9Z"},child:[]}]})(e)}function No(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 19H20V12H22V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V12H4V19ZM14 9H19L12 16L5 9H10V3H14V9Z"},child:[]}]})(e)}function Fo(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10 6V8H5V19H16V14H18V20C18 20.5523 17.5523 21 17 21H4C3.44772 21 3 20.5523 3 20V7C3 6.44772 3.44772 6 4 6H10ZM21 3V12L17.206 8.207L11.2071 14.2071L9.79289 12.7929L15.792 6.793L12 3H21Z"},child:[]}]})(e)}function Po(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5 10C3.9 10 3 10.9 3 12C3 13.1 3.9 14 5 14C6.1 14 7 13.1 7 12C7 10.9 6.1 10 5 10ZM19 10C17.9 10 17 10.9 17 12C17 13.1 17.9 14 19 14C20.1 14 21 13.1 21 12C21 10.9 20.1 10 19 10ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10Z"},child:[]}]})(e)}function Do(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM8 13C8 15.2091 9.79086 17 12 17C14.2091 17 16 15.2091 16 13H8ZM8 11C8.82843 11 9.5 10.3284 9.5 9.5C9.5 8.67157 8.82843 8 8 8C7.17157 8 6.5 8.67157 6.5 9.5C6.5 10.3284 7.17157 11 8 11ZM16 11C16.8284 11 17.5 10.3284 17.5 9.5C17.5 8.67157 16.8284 8 16 8C15.1716 8 14.5 8.67157 14.5 9.5C14.5 10.3284 15.1716 11 16 11Z"},child:[]}]})(e)}function Ze(e){return k({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM8 13H16C16 15.2091 14.2091 17 12 17C9.79086 17 8 15.2091 8 13ZM8 11C7.17157 11 6.5 10.3284 6.5 9.5C6.5 8.67157 7.17157 8 8 8C8.82843 8 9.5 8.67157 9.5 9.5C9.5 10.3284 8.82843 11 8 11ZM16 11C15.1716 11 14.5 10.3284 14.5 9.5C14.5 8.67157 15.1716 8 16 8C16.8284 8 17.5 8.67157 17.5 9.5C17.5 10.3284 16.8284 11 16 11Z"},child:[]}]})(e)}let Y;async function Zo(){return Y||(Y=(async()=>{const[e,t]=await Promise.all([import("emoji-mart"),import("@emoji-mart/data")]),n="default"in e?e.default:e,o="default"in t?t.default:t;return await n.init({data:o}),{emojiMart:n,emojiData:o}})(),Y)}function Oo(e){const t=a.useRef(null),n=a.useRef(null);return n.current&&n.current.update(e),a.useEffect(()=>((async()=>{const{emojiMart:o}=await Zo();n.current=new o.Picker({...e,ref:t})})(),()=>{n.current=null}),[]),E.default.createElement("div",{ref:t})}const Oe=e=>{const[t,n]=a.useState(!1),o=p(),r=R();return l.jsxs(o.Generic.Popover.Root,{opened:t,children:[l.jsx(o.Generic.Popover.Trigger,{children:l.jsx("div",{onClick:i=>{i.preventDefault(),i.stopPropagation(),n(!t)},style:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.children})}),l.jsx(o.Generic.Popover.Content,{variant:"panel-popover",children:l.jsx(Oo,{perLine:7,onClickOutside:()=>n(!1),onEmojiSelect:i=>{e.onEmojiSelect(i),n(!1)},theme:r==null?void 0:r.colorSchemePreference})})]})};function mt(e,t){return ie(e,[t]).get(t)}function ie(e,t){const n=e.comments;if(!n)throw new Error("Comments plugin not found");const o=n.userStore,r=a.useCallback(()=>{const d=new Map;for(const u of t){const c=o.getUser(u);c&&d.set(u,c)}return d},[o,t]),i=a.useMemo(()=>({current:r()}),[r]),s=a.useCallback(d=>{const u=o.subscribe(c=>{i.current=r(),d()});return o.loadUsers(t),u},[o,r,t,i]);return a.useSyncExternalStore(s,()=>i.current)}const Ao=e=>{const t=p(),n=v(),o=x();if(!o.comments)throw new Error("ReactionBadge must be used inside a BlockNote editor with comments enabled");const r=e.comment.reactions.find(u=>u.emoji===e.emoji);if(!r)throw new Error("Trying to render reaction badge for non-existing reaction");const[i,s]=a.useState([]),d=ie(o,i);return l.jsx(t.Generic.Badge.Root,{className:h.mergeCSSClasses("bn-badge","bn-comment-reaction"),text:r.userIds.length.toString(),icon:r.emoji,isSelected:o.comments.threadStore.auth.canDeleteReaction(e.comment,r.emoji),onClick:()=>e.onReactionSelect(r.emoji),onMouseEnter:()=>s(r.userIds),mainTooltip:n.comments.reactions.reacted_by,secondaryTooltip:`${Array.from(d.values()).map(u=>u.username).join(`
`)}`},r.emoji)},ft=({comment:e,thread:t,showResolveButton:n})=>{const o=v(),r=q({initialContent:e.body,trailingBlock:!1,dictionary:{...o,placeholders:{emptyDocument:o.placeholders.edit_comment}},schema:we},[e.body]),i=p(),[s,d]=a.useState(!1),u=x();if(!u.comments)throw new Error("Comments plugin not found");const c=u.comments.threadStore,m=a.useCallback(()=>{d(!0)},[]),g=a.useCallback(()=>{r.replaceBlocks(r.document,e.body),d(!1)},[r,e.body]),f=a.useCallback(async T=>{await c.updateComment({commentId:e.id,comment:{body:r.document},threadId:t.id}),d(!1)},[e,t.id,r,c]),b=a.useCallback(async()=>{await c.deleteComment({commentId:e.id,threadId:t.id})},[e,t.id,c]),w=a.useCallback(async T=>{c.auth.canAddReaction(e,T)?await c.addReaction({threadId:t.id,commentId:e.id,emoji:T}):c.auth.canDeleteReaction(e,T)&&await c.deleteReaction({threadId:t.id,commentId:e.id,emoji:T})},[c,e,t.id]),C=a.useCallback(async()=>{await c.resolveThread({threadId:t.id})},[t.id,c]),M=a.useCallback(async()=>{await c.unresolveThread({threadId:t.id})},[t.id,c]),H=mt(u,e.userId);if(!e.body)return null;let B;const V=c.auth.canAddReaction(e),P=c.auth.canDeleteComment(e),D=c.auth.canUpdateComment(e),_=n&&(t.resolved?c.auth.canUnresolveThread(t):c.auth.canResolveThread(t));s||(B=l.jsxs(i.Generic.Toolbar.Root,{className:h.mergeCSSClasses("bn-action-toolbar","bn-comment-actions"),variant:"action-toolbar",children:[V&&l.jsx(Oe,{onEmojiSelect:T=>w(T.native),children:l.jsx(i.Generic.Toolbar.Button,{mainTooltip:o.comments.actions.add_reaction,variant:"compact",children:l.jsx(Ze,{size:16})},"add-reaction")}),_&&(t.resolved?l.jsx(i.Generic.Toolbar.Button,{mainTooltip:"Re-open",variant:"compact",onClick:M,children:l.jsx(ao,{size:16})},"reopen"):l.jsx(i.Generic.Toolbar.Button,{mainTooltip:o.comments.actions.resolve,variant:"compact",onClick:C,children:l.jsx(Ro,{size:16})},"resolve")),(P||D)&&l.jsxs(i.Generic.Menu.Root,{position:"bottom-start",children:[l.jsx(i.Generic.Menu.Trigger,{children:l.jsx(i.Generic.Toolbar.Button,{mainTooltip:o.comments.actions.more_actions,variant:"compact",children:l.jsx(Po,{size:16})},"more-actions")}),l.jsxs(i.Generic.Menu.Dropdown,{className:"bn-menu-dropdown",children:[D&&l.jsx(i.Generic.Menu.Item,{icon:l.jsx(uo,{}),onClick:m,children:o.comments.actions.edit_comment},"edit-comment"),P&&l.jsx(i.Generic.Menu.Item,{icon:l.jsx(Io,{}),onClick:b,children:o.comments.actions.delete_comment},"delete-comment")]})]})]}));const O=e.createdAt.toLocaleDateString(void 0,{month:"short",day:"numeric"});if(!e.body)throw new Error("soft deletes are not yet supported");return l.jsx(i.Comments.Comment,{authorInfo:H??"loading",timeString:O,edited:e.updatedAt.getTime()!==e.createdAt.getTime(),showActions:"hover",actions:B,className:"bn-thread-comment",children:l.jsx(ke,{autoFocus:s,editor:r,editable:s,actions:e.reactions.length>0||s?({isEmpty:T})=>l.jsxs(l.Fragment,{children:[e.reactions.length>0&&!s&&l.jsxs(i.Generic.Badge.Group,{className:h.mergeCSSClasses("bn-badge-group","bn-comment-reactions"),children:[e.reactions.map(I=>l.jsx(Ao,{comment:e,emoji:I.emoji,onReactionSelect:w},I.emoji)),l.jsx(Oe,{onEmojiSelect:I=>w(I.native),children:l.jsx(i.Generic.Badge.Root,{className:h.mergeCSSClasses("bn-badge","bn-comment-add-reaction"),text:"+",icon:l.jsx(Ze,{size:16}),mainTooltip:o.comments.actions.add_reaction})})]}),s&&l.jsxs(i.Generic.Toolbar.Root,{variant:"action-toolbar",className:h.mergeCSSClasses("bn-action-toolbar","bn-comment-actions"),children:[l.jsx(i.Generic.Toolbar.Button,{mainTooltip:o.comments.save_button_text,variant:"compact",onClick:f,isDisabled:T,children:o.comments.save_button_text}),l.jsx(i.Generic.Toolbar.Button,{className:"bn-button",mainTooltip:o.comments.cancel_button_text,variant:"compact",onClick:g,children:o.comments.cancel_button_text})]})]}):void 0})})},gt=({thread:e,maxCommentsBeforeCollapse:t})=>{const n=p(),o=v(),r=x(),i=ie(r,e.resolvedBy?[e.resolvedBy]:[]),s=e.comments.map((d,u)=>l.jsx(ft,{thread:e,comment:d,showResolveButton:u===0},d.id));if(e.resolved&&e.resolvedUpdatedAt&&e.resolvedBy){if(!i.get(e.resolvedBy))throw new Error(`User ${e.resolvedBy} resolved thread ${e.id}, but their data could not be found.`);const u=e.comments.findLastIndex(c=>e.resolvedUpdatedAt.getTime()>c.createdAt.getTime())+1;s.splice(u,0,l.jsx(n.Comments.Comment,{className:"bn-thread-comment",authorInfo:e.resolvedBy&&i.get(e.resolvedBy)||"loading",timeString:e.resolvedUpdatedAt.toLocaleDateString(void 0,{month:"short",day:"numeric"}),edited:!1,showActions:!1,children:l.jsx("div",{className:"bn-resolved-text",children:o.comments.sidebar.marked_as_resolved})},"resolved-comment"))}return t&&s.length>t&&s.splice(1,s.length-2,l.jsx(n.Comments.ExpandSectionsPrompt,{className:"bn-thread-expand-prompt",children:o.comments.sidebar.more_replies(e.comments.length-2)},"expand-prompt")),s},Me=({thread:e,selected:t,referenceText:n,maxCommentsBeforeCollapse:o,onFocus:r,onBlur:i,tabIndex:s})=>{const d=p(),u=v(),m=x().comments;if(!m)throw new Error("Comments plugin not found");const g=q({trailingBlock:!1,dictionary:{...u,placeholders:{emptyDocument:u.placeholders.comment_reply}},schema:we}),f=a.useCallback(async()=>{await m.threadStore.addComment({comment:{body:g.document},threadId:e.id}),g.removeBlocks(g.document)},[m,g,e.id]);return l.jsxs(d.Comments.Card,{className:"bn-thread",headerText:n,onFocus:r,onBlur:i,selected:t,tabIndex:s,children:[l.jsx(d.Comments.CardSection,{className:"bn-thread-comments",children:l.jsx(gt,{thread:e,maxCommentsBeforeCollapse:t?void 0:o||5})}),t&&l.jsx(d.Comments.CardSection,{className:"bn-thread-composer",children:l.jsx(ke,{autoFocus:!1,editable:!0,editor:g,actions:({isEmpty:b})=>b?null:l.jsx(d.Generic.Toolbar.Root,{variant:"action-toolbar",className:h.mergeCSSClasses("bn-action-toolbar","bn-comment-actions"),children:l.jsx(d.Generic.Toolbar.Button,{mainTooltip:u.comments.save_button_text,variant:"compact",isDisabled:b,onClick:f,children:u.comments.save_button_text})})})})]})};function Se(e){const t=e.comments;if(!t)throw new Error("Comments plugin not found");const n=t.threadStore,o=a.useRef(void 0);o.current||(o.current=n.getThreads());const r=a.useCallback(i=>n.subscribe(s=>{o.current=s,i()}),[n]);return a.useSyncExternalStore(r,()=>o.current)}const ht=e=>{const t=x();if(!t.comments)throw new Error("FloatingComposerController can only be used when BlockNote editor has enabled comments");const n=L(t.comments.onUpdate.bind(t.comments)),{isMounted:o,ref:r,style:i,getFloatingProps:s,setReference:d}=N(!!(n!=null&&n.selectedThreadId),null,5e3,{placement:"bottom",middleware:[S.offset(10),S.shift(),S.flip()],onOpenChange:g=>{var f;g||((f=t.comments)==null||f.selectThread(void 0),t.focus())},...e.floatingOptions}),u=a.useCallback(()=>{var f;if(!(n!=null&&n.selectedThreadId))return;const g=(f=t.domElement)==null?void 0:f.querySelector(`[data-bn-thread-id="${n==null?void 0:n.selectedThreadId}"]`);g&&d(g)},[d,t,n==null?void 0:n.selectedThreadId]);a.useEffect(()=>{if(n!=null&&n.selectedThreadId)return t.onChange(()=>{u()})},[t,u,n==null?void 0:n.selectedThreadId]),a.useLayoutEffect(u,[u]);const c=Se(t);if(!o||!n||!n.selectedThreadId)return null;const m=e.floatingThread||Me;return l.jsx("div",{ref:r,style:i,...s(),children:l.jsx(m,{thread:c.get(n.selectedThreadId),selected:!0})})},bt=e=>{const t=p(),n=v(),{block:o}=e,r=x(),[i,s]=a.useState(""),d=a.useCallback(m=>{s(m.currentTarget.value)},[]),u=a.useCallback(m=>{m.key==="Enter"&&(m.preventDefault(),r.updateBlock(o,{props:{name:h.filenameFromURL(i),url:i}}))},[r,o,i]),c=a.useCallback(()=>{r.updateBlock(o,{props:{name:h.filenameFromURL(i),url:i}})},[r,o,i]);return l.jsxs(t.FilePanel.TabPanel,{className:"bn-tab-panel",children:[l.jsx(t.FilePanel.TextInput,{className:"bn-text-input",placeholder:n.file_panel.embed.url_placeholder,value:i,onChange:d,onKeyDown:u,"data-test":"embed-input"}),l.jsx(t.FilePanel.Button,{className:"bn-button",onClick:c,"data-test":"embed-input-button",children:n.file_panel.embed.embed_button[o.type]||n.file_panel.embed.embed_button.file})]})},Ct=e=>{var g;const t=p(),n=v(),{block:o,setLoading:r}=e,i=x(),[s,d]=a.useState(!1);a.useEffect(()=>{s&&setTimeout(()=>{d(!1)},3e3)},[s]);const u=a.useCallback(f=>{if(f===null)return;async function b(w){if(r(!0),i.uploadFile!==void 0)try{let C=await i.uploadFile(w,o.id);typeof C=="string"&&(C={props:{name:w.name,url:C}}),i.updateBlock(o,C)}catch{d(!0)}finally{r(!1)}}b(f)},[o,i,r]),c=i.schema.blockSchema[o.type],m=c.isFileBlock&&((g=c.fileBlockAccept)!=null&&g.length)?c.fileBlockAccept.join(","):"*/*";return l.jsxs(t.FilePanel.TabPanel,{className:"bn-tab-panel",children:[l.jsx(t.FilePanel.FileInput,{className:"bn-file-input","data-test":"upload-input",accept:m,placeholder:n.file_panel.upload.file_placeholder[o.type]||n.file_panel.upload.file_placeholder.file,value:null,onChange:u}),s&&l.jsx("div",{className:"bn-error-text",children:n.file_panel.upload.upload_error})]})},Be=e=>{const t=p(),n=v(),o=x(),[r,i]=a.useState(!1),s=e.tabs??[...o.uploadFile!==void 0?[{name:n.file_panel.upload.title,tabPanel:l.jsx(Ct,{block:e.block,setLoading:i})}]:[],{name:n.file_panel.embed.title,tabPanel:l.jsx(bt,{block:e.block})}],[d,u]=a.useState(e.defaultOpenTab||s[0].name);return l.jsx(t.FilePanel.Root,{className:"bn-panel",defaultOpenTab:d,openTab:d,setOpenTab:u,tabs:s,loading:r})},xt=e=>{const t=x();if(!t.filePanel)throw new Error("FileToolbarController can only be used when BlockNote editor schema contains file block");const n=L(t.filePanel.onUpdate.bind(t.filePanel)),{isMounted:o,ref:r,style:i,getFloatingProps:s}=N((n==null?void 0:n.show)||!1,(n==null?void 0:n.referencePos)||null,5e3,{placement:"bottom",middleware:[S.offset(10),S.flip()],onOpenChange:g=>{g||(t.filePanel.closeMenu(),t.focus())},...e.floatingOptions});if(!o||!n)return null;const{show:d,referencePos:u,...c}=n,m=e.filePanel||Be;return l.jsx("div",{ref:r,style:i,...s(),children:l.jsx(m,{...c})})};function Uo(e,t){if(t==null)return!1;if("composedPath"in e)return e.composedPath().includes(t);const n=e;return n.target!=null&&t.contains(n.target)}function F(e,t){U(e,t),W(e,t)}function pt(e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}function y(e){const t=R();if(e||(e=t==null?void 0:t.editor),!e)throw new Error("'editor' is required, either from BlockNoteContext or as a function argument");const n=e,[o,r]=a.useState(()=>{var s;return((s=n.getSelection())==null?void 0:s.blocks)||[n.getTextCursorPosition().block]}),i=a.useCallback(()=>{var s;return r(((s=n.getSelection())==null?void 0:s.blocks)||[n.getTextCursorPosition().block])},[n]);return F(i,n),o}const Go={bold:Co,italic:wo,underline:jo,strike:So,code:mo};function zo(e,t){return e in t.schema.styleSchema&&t.schema.styleSchema[e].type===e&&t.schema.styleSchema[e].propSchema==="boolean"}const G=e=>{const t=v(),n=p(),o=x(),r=zo(e.basicTextStyle,o),i=y(o),[s,d]=a.useState(e.basicTextStyle in o.getActiveStyles());F(()=>{r&&d(e.basicTextStyle in o.getActiveStyles())},o);const u=g=>{if(o.focus(),!!r){if(o.schema.styleSchema[g].propSchema!=="boolean")throw new Error("can only toggle boolean styles");o.toggleStyles({[g]:!0})}};if(!a.useMemo(()=>r?!!i.find(g=>g.content!==void 0):!1,[r,i])||!o.isEditable)return null;const m=Go[e.basicTextStyle];return l.jsx(n.FormattingToolbar.Button,{className:"bn-button","data-test":e.basicTextStyle,onClick:()=>u(e.basicTextStyle),isSelected:s,label:t.formatting_toolbar[e.basicTextStyle].tooltip,mainTooltip:t.formatting_toolbar[e.basicTextStyle].tooltip,secondaryTooltip:h.formatKeyboardShortcut(t.formatting_toolbar[e.basicTextStyle].secondary_tooltip,t.generic.ctrl_shortcut),icon:l.jsx(m,{})})},ge=e=>{const t=e.textColor||"default",n=e.backgroundColor||"default",o=e.size||16,r=a.useMemo(()=>({pointerEvents:"none",fontSize:(o*.75).toString()+"px",height:o.toString()+"px",lineHeight:o.toString()+"px",textAlign:"center",width:o.toString()+"px"}),[o]);return l.jsx("div",{className:"bn-color-icon","data-background-color":n,"data-text-color":t,style:r,children:"A"})},Ae=["default","gray","brown","red","orange","yellow","green","blue","purple","pink"],se=e=>{const t=p(),n=v(),o=()=>e.text?l.jsxs(l.Fragment,{children:[l.jsx(t.Generic.Menu.Label,{children:n.color_picker.text_title}),Ae.map(i=>l.jsx(t.Generic.Menu.Item,{onClick:()=>{e.onClick&&e.onClick(),e.text.setColor(i)},"data-test":"text-color-"+i,icon:l.jsx(ge,{textColor:i,size:e.iconSize}),checked:e.text.color===i,children:n.color_picker.colors[i]},"text-color-"+i))]}):null,r=()=>e.background?l.jsxs(l.Fragment,{children:[l.jsx(t.Generic.Menu.Label,{children:n.color_picker.background_title}),Ae.map(i=>l.jsx(t.Generic.Menu.Item,{onClick:()=>{e.onClick&&e.onClick(),e.background.setColor(i)},"data-test":"background-color-"+i,icon:l.jsx(ge,{backgroundColor:i,size:e.iconSize}),checked:e.background.color===i,children:n.color_picker.colors[i]},"background-color-"+i))]}):null;return l.jsxs(l.Fragment,{children:[l.jsx(o,{}),l.jsx(r,{})]})};function Ue(e,t){return`${e}Color`in t.schema.styleSchema&&t.schema.styleSchema[`${e}Color`].type===`${e}Color`&&t.schema.styleSchema[`${e}Color`].propSchema==="string"}const kt=()=>{const e=p(),t=v(),n=x(),o=Ue("text",n),r=Ue("background",n),i=y(n),[s,d]=a.useState(o&&n.getActiveStyles().textColor||"default"),[u,c]=a.useState(r&&n.getActiveStyles().backgroundColor||"default");F(()=>{o&&d(n.getActiveStyles().textColor||"default"),r&&c(n.getActiveStyles().backgroundColor||"default")},n);const m=a.useCallback(b=>{if(!o)throw Error("Tried to set text color, but style does not exist in editor schema.");b==="default"?n.removeStyles({textColor:b}):n.addStyles({textColor:b}),setTimeout(()=>{n.focus()})},[n,o]),g=a.useCallback(b=>{if(!r)throw Error("Tried to set background color, but style does not exist in editor schema.");b==="default"?n.removeStyles({backgroundColor:b}):n.addStyles({backgroundColor:b}),setTimeout(()=>{n.focus()})},[r,n]);return!a.useMemo(()=>{if(!o&&!r)return!1;for(const b of i)if(b.content!==void 0)return!0;return!1},[r,i,o])||!n.isEditable?null:l.jsxs(e.Generic.Menu.Root,{children:[l.jsx(e.Generic.Menu.Trigger,{children:l.jsx(e.FormattingToolbar.Button,{className:"bn-button","data-test":"colors",label:t.formatting_toolbar.colors.tooltip,mainTooltip:t.formatting_toolbar.colors.tooltip,icon:l.jsx(ge,{textColor:s,backgroundColor:u,size:20})})}),l.jsx(e.Generic.Menu.Dropdown,{className:"bn-menu-dropdown bn-color-picker-dropdown",children:l.jsx(se,{text:o?{color:s,setColor:m}:void 0,background:r?{color:u,setColor:g}:void 0})})]})},Ge=e=>{for(const t of h.VALID_LINK_PROTOCOLS)if(e.startsWith(t))return e;return`${h.DEFAULT_LINK_PROTOCOL}://${e}`},je=e=>{const t=p(),n=v(),{url:o,text:r,editLink:i,showTextField:s}=e,[d,u]=a.useState(o),[c,m]=a.useState(r);a.useEffect(()=>{u(o),m(r)},[r,o]);const g=a.useCallback(C=>{C.key==="Enter"&&(C.preventDefault(),i(Ge(d),c))},[i,d,c]),f=a.useCallback(C=>u(C.currentTarget.value),[]),b=a.useCallback(C=>m(C.currentTarget.value),[]),w=a.useCallback(()=>i(Ge(d),c),[i,d,c]);return l.jsxs(t.Generic.Form.Root,{children:[l.jsx(t.Generic.Form.TextInput,{className:"bn-text-input",name:"url",icon:l.jsx(lt,{}),autoFocus:!0,placeholder:n.link_toolbar.form.url_placeholder,value:d,onKeyDown:g,onChange:f,onSubmit:w}),s!==!1&&l.jsx(t.Generic.Form.TextInput,{className:"bn-text-input",name:"title",icon:l.jsx(He,{}),placeholder:n.link_toolbar.form.title_placeholder,value:c,onKeyDown:g,onChange:b,onSubmit:w})]})};function Wo(e){return"link"in e.schema.inlineContentSchema&&e.schema.inlineContentSchema.link==="link"}const wt=()=>{var w;const e=x(),t=p(),n=v(),o=Wo(e),r=y(e),[i,s]=a.useState(!1),[d,u]=a.useState(e.getSelectedLinkUrl()||""),[c,m]=a.useState(e.getSelectedText());F(()=>{m(e.getSelectedText()||""),u(e.getSelectedLinkUrl()||"")},e),a.useEffect(()=>{var M;const C=H=>{(H.ctrlKey||H.metaKey)&&H.key==="k"&&(s(!0),H.preventDefault())};return(M=e.prosemirrorView)==null||M.dom.addEventListener("keydown",C),()=>{var H;(H=e.prosemirrorView)==null||H.dom.removeEventListener("keydown",C)}},[(w=e.prosemirrorView)==null?void 0:w.dom]);const g=a.useCallback(C=>{e.createLink(C),e.focus()},[e]),f=e.transact(C=>h.isTableCellSelection(C.selection));return!a.useMemo(()=>{if(!o)return!1;for(const C of r)if(C.content===void 0)return!1;return!f},[o,r,f])||!("link"in e.schema.inlineContentSchema)||!e.isEditable?null:l.jsxs(t.Generic.Popover.Root,{opened:i,children:[l.jsx(t.Generic.Popover.Trigger,{children:l.jsx(t.FormattingToolbar.Button,{className:"bn-button","data-test":"createLink",label:n.formatting_toolbar.link.tooltip,mainTooltip:n.formatting_toolbar.link.tooltip,secondaryTooltip:h.formatKeyboardShortcut(n.formatting_toolbar.link.secondary_tooltip,n.generic.ctrl_shortcut),icon:l.jsx(lt,{}),onClick:()=>s(!0)})}),l.jsx(t.Generic.Popover.Content,{className:"bn-popover-content bn-form-popover",variant:"form-popover",children:l.jsx(je,{url:d,text:c,editLink:g,showTextField:!1})})]})},vt=()=>{const e=v(),t=p(),n=x(),[o,r]=a.useState(),i=y(n),s=a.useMemo(()=>{if(i.length!==1)return;const c=i[0];if(h.checkBlockIsFileBlock(c,n))return r(c.props.caption),c},[n,i]),d=a.useCallback(c=>{s&&c.key==="Enter"&&(c.preventDefault(),n.updateBlock(s,{props:{caption:o}}))},[o,n,s]),u=a.useCallback(c=>r(c.currentTarget.value),[]);return!s||h.checkBlockIsFileBlockWithPlaceholder(s,n)||!n.isEditable?null:l.jsxs(t.Generic.Popover.Root,{children:[l.jsx(t.Generic.Popover.Trigger,{children:l.jsx(t.FormattingToolbar.Button,{className:"bn-button",label:e.formatting_toolbar.file_caption.tooltip,mainTooltip:e.formatting_toolbar.file_caption.tooltip,icon:l.jsx(De,{}),isSelected:s.props.caption!==""})}),l.jsx(t.Generic.Popover.Content,{className:"bn-popover-content bn-form-popover",variant:"form-popover",children:l.jsx(t.Generic.Form.Root,{children:l.jsx(t.Generic.Form.TextInput,{name:"file-caption",icon:l.jsx(De,{}),value:o||"",autoFocus:!0,placeholder:e.formatting_toolbar.file_caption.input_placeholder,onKeyDown:d,onChange:u})})})]})},Ht=()=>{const e=v(),t=p(),n=x(),o=y(n),r=a.useMemo(()=>{if(o.length!==1)return;const s=o[0];if(h.checkBlockIsFileBlock(s,n))return s},[n,o]),i=a.useCallback(()=>{n.focus(),n.removeBlocks([r])},[n,r]);return!r||h.checkBlockIsFileBlockWithPlaceholder(r,n)||!n.isEditable?null:l.jsx(t.FormattingToolbar.Button,{className:"bn-button",label:e.formatting_toolbar.file_delete.tooltip[r.type]||e.formatting_toolbar.file_delete.tooltip.file,mainTooltip:e.formatting_toolbar.file_delete.tooltip[r.type]||e.formatting_toolbar.file_delete.tooltip.file,icon:l.jsx(_o,{}),onClick:i})},Mt=()=>{const e=v(),t=p(),n=x(),[o,r]=a.useState(),i=y(n),s=a.useMemo(()=>{if(i.length!==1)return;const c=i[0];if(h.checkBlockIsFileBlock(c,n))return r(c.props.name),c},[n,i]),d=a.useCallback(c=>{s&&c.key==="Enter"&&(c.preventDefault(),n.updateBlock(s,{props:{name:o}}))},[o,n,s]),u=a.useCallback(c=>r(c.currentTarget.value),[]);return!s||h.checkBlockIsFileBlockWithPlaceholder(s,n)||!n.isEditable?null:l.jsxs(t.Generic.Popover.Root,{children:[l.jsx(t.Generic.Popover.Trigger,{children:l.jsx(t.FormattingToolbar.Button,{className:"bn-button",label:e.formatting_toolbar.file_rename.tooltip[s.type]||e.formatting_toolbar.file_rename.tooltip.file,mainTooltip:e.formatting_toolbar.file_rename.tooltip[s.type]||e.formatting_toolbar.file_rename.tooltip.file,icon:l.jsx(Pe,{})})}),l.jsx(t.Generic.Popover.Content,{className:"bn-popover-content bn-form-popover",variant:"form-popover",children:l.jsx(t.Generic.Form.Root,{children:l.jsx(t.Generic.Form.TextInput,{name:"file-name",icon:l.jsx(Pe,{}),value:o||"",autoFocus:!0,placeholder:e.formatting_toolbar.file_rename.input_placeholder[s.type]||e.formatting_toolbar.file_rename.input_placeholder.file,onKeyDown:d,onChange:u})})})]})},St=()=>{const e=v(),t=p(),n=x(),o=y(n),[r,i]=a.useState(!1);a.useEffect(()=>{i(!1)},[o]);const s=o.length===1?o[0]:void 0;return s===void 0||!h.checkBlockIsFileBlock(s,n)||!n.isEditable?null:l.jsxs(t.Generic.Popover.Root,{opened:r,position:"bottom",children:[l.jsx(t.Generic.Popover.Trigger,{children:l.jsx(t.FormattingToolbar.Button,{className:"bn-button",onClick:()=>i(!r),isSelected:r,mainTooltip:e.formatting_toolbar.file_replace.tooltip[s.type]||e.formatting_toolbar.file_replace.tooltip.file,label:e.formatting_toolbar.file_replace.tooltip[s.type]||e.formatting_toolbar.file_replace.tooltip.file,icon:l.jsx(Vo,{})})}),l.jsx(t.Generic.Popover.Content,{className:"bn-popover-content bn-panel-popover",variant:"panel-popover",children:l.jsx(Be,{block:s})})]})},Bt=()=>{const e=v(),t=p(),n=x(),o=y(n),[r,i]=a.useState(()=>n.canNestBlock());F(()=>{i(n.canNestBlock())},n);const s=a.useCallback(()=>{n.focus(),n.nestBlock()},[n]);return!a.useMemo(()=>!o.find(u=>n.schema.blockSchema[u.type].content!=="inline"),[n.schema.blockSchema,o])||!n.isEditable?null:l.jsx(t.FormattingToolbar.Button,{className:"bn-button","data-test":"nestBlock",onClick:s,isDisabled:!r,label:e.formatting_toolbar.nest.tooltip,mainTooltip:e.formatting_toolbar.nest.tooltip,secondaryTooltip:h.formatKeyboardShortcut(e.formatting_toolbar.nest.secondary_tooltip,e.generic.ctrl_shortcut),icon:l.jsx(ko,{})})},jt=()=>{const e=v(),t=p(),n=x(),o=y(n),[r,i]=a.useState(()=>n.canUnnestBlock());F(()=>{i(n.canUnnestBlock())},n);const s=a.useCallback(()=>{n.focus(),n.unnestBlock()},[n]);return!a.useMemo(()=>!o.find(u=>n.schema.blockSchema[u.type].content!=="inline"),[n.schema.blockSchema,o])||!n.isEditable?null:l.jsx(t.FormattingToolbar.Button,{className:"bn-button","data-test":"unnestBlock",onClick:s,isDisabled:!r,label:e.formatting_toolbar.unnest.tooltip,mainTooltip:e.formatting_toolbar.unnest.tooltip,secondaryTooltip:h.formatKeyboardShortcut(e.formatting_toolbar.unnest.secondary_tooltip,e.generic.ctrl_shortcut),icon:l.jsx(po,{})})},yt=e=>[{name:e.slash_menu.paragraph.title,type:"paragraph",icon:He,isSelected:t=>t.type==="paragraph"},{name:e.slash_menu.heading.title,type:"heading",props:{level:1},icon:ne,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===1},{name:e.slash_menu.heading_2.title,type:"heading",props:{level:2},icon:oe,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===2},{name:e.slash_menu.heading_3.title,type:"heading",props:{level:3},icon:le,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===3},{name:e.slash_menu.heading_4.title,type:"heading",props:{level:4},icon:tt,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===4},{name:e.slash_menu.heading_5.title,type:"heading",props:{level:5},icon:nt,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===5},{name:e.slash_menu.heading_6.title,type:"heading",props:{level:6},icon:ot,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===6},{name:e.slash_menu.toggle_heading.title,type:"heading",props:{level:1,isToggleable:!0},icon:ne,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===1&&"isToggleable"in t.props&&t.props.isToggleable},{name:e.slash_menu.toggle_heading_2.title,type:"heading",props:{level:2,isToggleable:!0},icon:oe,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===2&&"isToggleable"in t.props&&t.props.isToggleable},{name:e.slash_menu.toggle_heading_3.title,type:"heading",props:{level:3,isToggleable:!0},icon:le,isSelected:t=>t.type==="heading"&&"level"in t.props&&t.props.level===3&&"isToggleable"in t.props&&t.props.isToggleable},{name:e.slash_menu.quote.title,type:"quote",icon:ct,isSelected:t=>t.type==="quote"},{name:e.slash_menu.toggle_list.title,type:"toggleListItem",icon:dt,isSelected:t=>t.type==="toggleListItem"},{name:e.slash_menu.bullet_list.title,type:"bulletListItem",icon:st,isSelected:t=>t.type==="bulletListItem"},{name:e.slash_menu.numbered_list.title,type:"numberedListItem",icon:it,isSelected:t=>t.type==="numberedListItem"},{name:e.slash_menu.check_list.title,type:"checkListItem",icon:rt,isSelected:t=>t.type==="checkListItem"}],Tt=e=>{const t=p(),n=v(),o=x(),r=y(o),[i,s]=a.useState(o.getTextCursorPosition().block),d=a.useMemo(()=>(e.items||yt(n)).filter(m=>m.type in o.schema.blockSchema),[o,n,e.items]),u=a.useMemo(()=>d.find(m=>m.type===i.type)!==void 0,[i.type,d]),c=a.useMemo(()=>{const m=g=>{o.focus(),o.transact(()=>{for(const f of r)o.updateBlock(f,{type:g.type,props:g.props})})};return d.map(g=>{const f=g.icon;return{text:g.name,icon:l.jsx(f,{size:16}),onClick:()=>m(g),isSelected:g.isSelected(i)}})},[i,d,o,r]);return F(()=>{s(o.getTextCursorPosition().block)},o),!u||!o.isEditable?null:l.jsx(t.FormattingToolbar.Select,{className:"bn-select",items:c})},Vt=()=>{const e=v(),t=p(),n=x(),o=a.useCallback(()=>{var r;(r=n.comments)==null||r.startPendingComment(),n.formattingToolbar.closeMenu()},[n]);return n.comments?l.jsx(t.FormattingToolbar.Button,{className:"bn-button",label:e.formatting_toolbar.comment.tooltip,mainTooltip:e.formatting_toolbar.comment.tooltip,icon:l.jsx(et,{}),onClick:o}):null},Lt=()=>{const e=v(),t=p(),n=x(),o=a.useCallback(()=>{n._tiptapEditor.chain().focus().addPendingComment().run()},[n]);return!n._tiptapEditor.commands.addPendingComment||!n.isEditable?null:l.jsx(t.FormattingToolbar.Button,{className:"bn-button",label:e.formatting_toolbar.comment.tooltip,mainTooltip:e.formatting_toolbar.comment.tooltip,icon:l.jsx(et,{}),onClick:o})};function he(e,t){try{const n=new URL(e,t);if(n.protocol!=="javascript:")return n.href}catch{}return"#"}const Et=()=>{const e=v(),t=p(),n=x(),o=y(n),r=a.useMemo(()=>{if(o.length!==1)return;const s=o[0];if(h.checkBlockIsFileBlock(s,n))return s},[n,o]),i=a.useCallback(()=>{r&&r.props.url&&(n.focus(),n.resolveFileUrl?n.resolveFileUrl(r.props.url).then(s=>window.open(he(s,window.location.href))):window.open(he(r.props.url,window.location.href)))},[n,r]);return!r||h.checkBlockIsFileBlockWithPlaceholder(r,n)?null:l.jsx(t.FormattingToolbar.Button,{className:"bn-button",label:e.formatting_toolbar.file_download.tooltip[r.type]||e.formatting_toolbar.file_download.tooltip.file,mainTooltip:e.formatting_toolbar.file_download.tooltip[r.type]||e.formatting_toolbar.file_download.tooltip.file,icon:l.jsx(No,{}),onClick:i})},Rt=()=>{const e=v(),t=p(),n=x(),o=y(n),r=a.useMemo(()=>{if(o.length!==1)return;const s=o[0];if(h.checkBlockIsFileBlockWithPreview(s,n))return s},[n,o]),i=a.useCallback(()=>{r&&n.updateBlock(r,{props:{showPreview:!r.props.showPreview}})},[n,r]);return!r||h.checkBlockIsFileBlockWithPlaceholder(r,n)||!n.isEditable?null:l.jsx(t.FormattingToolbar.Button,{className:"bn-button",label:"Toggle preview",mainTooltip:e.formatting_toolbar.file_preview_toggle.tooltip,icon:l.jsx(To,{}),isSelected:r.props.showPreview,onClick:i})},_t=()=>{const e=v(),t=p(),n=x(),o=y(n),r=a.useMemo(()=>{var d;if(o.length!==1)return;const s=o[0];if(s.type==="table")return(d=n.tableHandles)==null?void 0:d.getMergeDirection(s)},[n,o]),i=a.useCallback(()=>{var s;(s=n.tableHandles)==null||s.mergeCells()},[n]);return!n.isEditable||r===void 0||!n.settings.tables.splitCells?null:l.jsx(t.FormattingToolbar.Button,{className:"bn-button",label:e.formatting_toolbar.table_cell_merge.tooltip,mainTooltip:e.formatting_toolbar.table_cell_merge.tooltip,icon:r==="horizontal"?l.jsx(Ho,{}):l.jsx(Mo,{}),onClick:i})},qo={left:ho,center:fo,right:bo,justify:go},J=e=>{const t=p(),n=v(),o=x(),r=y(o),i=a.useMemo(()=>{var m;const c=r[0];if(h.checkBlockHasDefaultProp("textAlignment",c,o))return c.props.textAlignment;if(c.type==="table"){const g=(m=o.tableHandles)==null?void 0:m.getCellSelection();if(!g)return;const f=g.cells.map(({row:w,col:C})=>h.mapTableCell(c.content.rows[w].cells[C]).props.textAlignment),b=f[0];if(f.every(w=>w===b))return b}},[o,r]),s=a.useCallback(c=>{var m;o.focus();for(const g of r)if(h.checkBlockTypeHasDefaultProp("textAlignment",g.type,o))o.updateBlock(g,{props:{textAlignment:c}});else if(g.type==="table"){const f=(m=o.tableHandles)==null?void 0:m.getCellSelection();if(!f)continue;const b=g.content.rows.map(w=>({...w,cells:w.cells.map(C=>h.mapTableCell(C))}));f.cells.forEach(({row:w,col:C})=>{b[w].cells[C].props.textAlignment=c}),o.updateBlock(g,{type:"table",content:{...g.content,type:"tableContent",rows:b}}),o.setTextCursorPosition(g)}},[o,r]);if(!a.useMemo(()=>!!r.find(c=>"textAlignment"in c.props||c.type==="table"&&c.children),[r])||!o.isEditable)return null;const u=qo[e.textAlignment];return l.jsx(t.FormattingToolbar.Button,{className:"bn-button","data-test":`alignText${e.textAlignment.slice(0,1).toUpperCase()+e.textAlignment.slice(1)}`,onClick:()=>s(e.textAlignment),isSelected:i===e.textAlignment,label:n.formatting_toolbar[`align_${e.textAlignment}`].tooltip,mainTooltip:n.formatting_toolbar[`align_${e.textAlignment}`].tooltip,icon:l.jsx(u,{})})},It=e=>[l.jsx(Tt,{items:e},"blockTypeSelect"),l.jsx(_t,{},"tableCellMergeButton"),l.jsx(vt,{},"fileCaptionButton"),l.jsx(St,{},"replaceFileButton"),l.jsx(Mt,{},"fileRenameButton"),l.jsx(Ht,{},"fileDeleteButton"),l.jsx(Et,{},"fileDownloadButton"),l.jsx(Rt,{},"filePreviewButton"),l.jsx(G,{basicTextStyle:"bold"},"boldStyleButton"),l.jsx(G,{basicTextStyle:"italic"},"italicStyleButton"),l.jsx(G,{basicTextStyle:"underline"},"underlineStyleButton"),l.jsx(G,{basicTextStyle:"strike"},"strikeStyleButton"),l.jsx(J,{textAlignment:"left"},"textAlignLeftButton"),l.jsx(J,{textAlignment:"center"},"textAlignCenterButton"),l.jsx(J,{textAlignment:"right"},"textAlignRightButton"),l.jsx(kt,{},"colorStyleButton"),l.jsx(Bt,{},"nestBlockButton"),l.jsx(jt,{},"unnestBlockButton"),l.jsx(wt,{},"createLinkButton"),l.jsx(Vt,{},"addCommentButton"),l.jsx(Lt,{},"addTiptapCommentButton")],ye=e=>{const t=p();return l.jsx(t.FormattingToolbar.Root,{className:"bn-toolbar bn-formatting-toolbar",children:e.children||It(e.blockTypeSelectItems)})},ze=e=>{switch(e){case"left":return"top-start";case"center":return"top";case"right":return"top-end";default:return"top-start"}},Nt=e=>{const t=a.useRef(null),n=x(),[o,r]=a.useState(()=>{const f=n.getTextCursorPosition().block;return"textAlignment"in f.props?ze(f.props.textAlignment):"top-start"});F(()=>{const f=n.getTextCursorPosition().block;"textAlignment"in f.props?r(ze(f.props.textAlignment)):r("top-start")},n);const i=L(n.formattingToolbar.onUpdate.bind(n.formattingToolbar)),{isMounted:s,ref:d,style:u,getFloatingProps:c}=N((i==null?void 0:i.show)||!1,(i==null?void 0:i.referencePos)||null,3e3,{placement:o,middleware:[S.offset(10),S.shift(),S.flip()],onOpenChange:(f,b)=>{f||(n.formattingToolbar.closeMenu(),n.focus())},canDismiss:{enabled:!0,escapeKey:!0,outsidePress:f=>{var C;const b=(C=n._tiptapEditor)==null?void 0:C.view;return!b||!f.target?!1:!Uo(f,b.dom.parentElement)}},...e.floatingOptions}),m=a.useMemo(()=>pt([t,d]),[t,d]);if(!s||!i)return null;if(!i.show&&t.current)return l.jsx("div",{ref:m,style:u,dangerouslySetInnerHTML:{__html:t.current.innerHTML}});const g=e.formattingToolbar||ye;return l.jsx("div",{ref:m,style:u,...c(),children:l.jsx(g,{})})},Ft=e=>{const t=p(),n=v();return l.jsx(t.LinkToolbar.Button,{className:"bn-button",label:n.link_toolbar.delete.tooltip,mainTooltip:n.link_toolbar.delete.tooltip,isSelected:!1,onClick:e.deleteLink,icon:l.jsx(vo,{})})},Pt=e=>{const t=p(),n=v();return l.jsxs(t.Generic.Popover.Root,{children:[l.jsx(t.Generic.Popover.Trigger,{children:l.jsx(t.LinkToolbar.Button,{className:"bn-button",mainTooltip:n.link_toolbar.edit.tooltip,isSelected:!1,children:n.link_toolbar.edit.text})}),l.jsx(t.Generic.Popover.Content,{className:"bn-popover-content bn-form-popover",variant:"form-popover",children:l.jsx(je,{...e})})]})},Dt=e=>{const t=p(),n=v();return l.jsx(t.LinkToolbar.Button,{className:"bn-button",mainTooltip:n.link_toolbar.open.tooltip,label:n.link_toolbar.open.tooltip,isSelected:!1,onClick:()=>{window.open(he(e.url,window.location.href),"_blank")},icon:l.jsx(Fo,{})})},Zt=e=>{const t=p();return e.children?l.jsx(t.LinkToolbar.Root,{className:"bn-toolbar bn-link-toolbar",children:e.children}):l.jsxs(t.LinkToolbar.Root,{className:"bn-toolbar bn-link-toolbar",onMouseEnter:e.stopHideTimer,onMouseLeave:e.startHideTimer,children:[l.jsx(Pt,{url:e.url,text:e.text,editLink:e.editLink}),l.jsx(Dt,{url:e.url}),l.jsx(Ft,{deleteLink:e.deleteLink})]})},Ot=e=>{const t=x(),n={deleteLink:t.linkToolbar.deleteLink,editLink:t.linkToolbar.editLink,startHideTimer:t.linkToolbar.startHideTimer,stopHideTimer:t.linkToolbar.stopHideTimer},o=L(t.linkToolbar.onUpdate.bind(t.linkToolbar)),{isMounted:r,ref:i,style:s,getFloatingProps:d}=N((o==null?void 0:o.show)||!1,(o==null?void 0:o.referencePos)||null,4e3,{placement:"top-start",middleware:[S.offset(10),S.flip()],onOpenChange:f=>{f||(t.linkToolbar.closeMenu(),t.focus())},...e.floatingOptions});if(!r||!o)return null;const{show:u,referencePos:c,...m}=o,g=e.linkToolbar||Zt;return l.jsx("div",{ref:i,style:s,...d(),children:l.jsx(g,{...m,...n})})};function $o(e){return k({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8Z"},child:[]},{tag:"path",attr:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8Z"},child:[]}]})(e)}const At=e=>{const t=p(),n=v(),o=x(),r=a.useCallback(()=>{const i=e.block.content;if(i!==void 0&&Array.isArray(i)&&i.length===0)o.setTextCursorPosition(e.block),o.openSuggestionMenu("/");else{const d=o.insertBlocks([{type:"paragraph"}],e.block,"after")[0];o.setTextCursorPosition(d),o.openSuggestionMenu("/")}},[o,e.block]);return l.jsx(t.SideMenu.Button,{className:"bn-button",label:n.side_menu.add_block_label,icon:l.jsx($o,{size:24,onClick:r,"data-test":"dragHandleAdd"})})};function Ut(e){return k({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(e)}function Ko(e){return k({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m7 10 5 5 5-5z"},child:[]}]})(e)}const Gt=e=>{const t=p(),n=x();return!h.checkBlockTypeHasDefaultProp("textColor",e.block.type,n)&&!h.checkBlockTypeHasDefaultProp("backgroundColor",e.block.type,n)?null:l.jsxs(t.Generic.Menu.Root,{position:"right",sub:!0,children:[l.jsx(t.Generic.Menu.Trigger,{sub:!0,children:l.jsx(t.Generic.Menu.Item,{className:"bn-menu-item",subTrigger:!0,children:e.children})}),l.jsx(t.Generic.Menu.Dropdown,{sub:!0,className:"bn-menu-dropdown bn-color-picker-dropdown",children:l.jsx(se,{iconSize:18,text:h.checkBlockTypeHasDefaultProp("textColor",e.block.type,n)&&h.checkBlockHasDefaultProp("textColor",e.block,n)?{color:e.block.props.textColor,setColor:o=>n.updateBlock(e.block,{type:e.block.type,props:{textColor:o}})}:void 0,background:h.checkBlockTypeHasDefaultProp("backgroundColor",e.block.type,n)&&h.checkBlockHasDefaultProp("backgroundColor",e.block,n)?{color:e.block.props.backgroundColor,setColor:o=>n.updateBlock(e.block,{props:{backgroundColor:o}})}:void 0})})]})},zt=e=>{const t=p(),n=x();return l.jsx(t.Generic.Menu.Item,{className:"bn-menu-item",onClick:()=>n.removeBlocks([e.block]),children:e.children})},Wt=e=>{const t=p(),n=x();if(e.block.type!=="table"||!n.settings.tables.headers)return null;const o=!!e.block.content.headerRows;return l.jsx(t.Generic.Menu.Item,{className:"bn-menu-item",checked:o,onClick:()=>{const r=n.getBlock(e.block.id);r&&n.updateBlock(r,{...r,content:{...r.content,headerRows:o?void 0:1}})},children:e.children})},qt=e=>{const t=p(),n=x();if(e.block.type!=="table"||!n.settings.tables.headers)return null;const o=!!e.block.content.headerCols;return l.jsx(t.Generic.Menu.Item,{className:"bn-menu-item",checked:o,onClick:()=>{n.updateBlock(e.block,{type:"table",content:{...e.block.content,type:"tableContent",headerCols:o?void 0:1}})},children:e.children})},$t=e=>{const t=p(),n=v();return l.jsx(t.Generic.Menu.Dropdown,{className:"bn-menu-dropdown bn-drag-handle-menu",children:e.children||l.jsxs(l.Fragment,{children:[l.jsx(zt,{...e,children:n.drag_handle.delete_menuitem}),l.jsx(Gt,{...e,children:n.drag_handle.colors_menuitem}),l.jsx(Wt,{...e,children:n.drag_handle.header_row_menuitem}),l.jsx(qt,{...e,children:n.drag_handle.header_column_menuitem})]})})},Kt=e=>{const t=p(),n=v(),o=e.dragHandleMenu||$t;return l.jsxs(t.Generic.Menu.Root,{onOpenChange:r=>{r?e.freezeMenu():e.unfreezeMenu()},position:"left",children:[l.jsx(t.Generic.Menu.Trigger,{children:l.jsx(t.SideMenu.Button,{label:n.side_menu.drag_handle_label,draggable:!0,onDragStart:r=>e.blockDragStart(r,e.block),onDragEnd:e.blockDragEnd,className:"bn-button",icon:l.jsx(Ut,{size:24,"data-test":"dragHandle"})})}),l.jsx(o,{block:e.block,children:e.children})]})},Xt=e=>{const t=p(),n=a.useMemo(()=>{const o={"data-block-type":e.block.type};return e.block.type==="heading"&&(o["data-level"]=e.block.props.level.toString()),e.editor.schema.blockSchema[e.block.type].isFileBlock&&(e.block.props.url?o["data-url"]="true":o["data-url"]="false"),o},[e.block,e.editor.schema.blockSchema]);return l.jsx(t.SideMenu.Root,{className:"bn-side-menu",...n,children:e.children||l.jsxs(l.Fragment,{children:[l.jsx(At,{...e}),l.jsx(Kt,{...e})]})})},Yt=e=>{const t=x(),n={blockDragStart:t.sideMenu.blockDragStart,blockDragEnd:t.sideMenu.blockDragEnd,freezeMenu:t.sideMenu.freezeMenu,unfreezeMenu:t.sideMenu.unfreezeMenu},o=L(t.sideMenu.onUpdate.bind(t.sideMenu)),{isMounted:r,ref:i,style:s,getFloatingProps:d}=N((o==null?void 0:o.show)||!1,(o==null?void 0:o.referencePos)||null,1e3,{placement:"left-start",...e.floatingOptions});if(!r||!o)return null;const{show:u,referencePos:c,...m}=o,g=e.sideMenu||Xt;return l.jsx("div",{ref:i,style:s,...d(),children:l.jsx(g,{...m,...n,editor:t})})};async function Jt(e,t){return(await h.getDefaultEmojiPickerItems(e,t)).map(({id:n,onItemClick:o})=>({id:n,onItemClick:o,icon:n}))}function Xo(e){const t=p(),n=v(),{items:o,loadingState:r,selectedIndex:i,onItemClick:s,columns:d}=e,u=r==="loading-initial"||r==="loading"?l.jsx(t.GridSuggestionMenu.Loader,{className:"bn-grid-suggestion-menu-loader",columns:d}):null,c=a.useMemo(()=>{const m=[];for(let g=0;g<o.length;g++){const f=o[g];m.push(l.jsx(t.GridSuggestionMenu.Item,{className:"bn-grid-suggestion-menu-item",item:f,id:`bn-grid-suggestion-menu-item-${g}`,isSelected:g===i,onClick:()=>s==null?void 0:s(f)},f.id))}return m},[t,o,s,i]);return l.jsxs(t.GridSuggestionMenu.Root,{id:"bn-grid-suggestion-menu",columns:d,className:"bn-grid-suggestion-menu",children:[u,c,c.length===0&&e.loadingState==="loaded"&&l.jsx(t.GridSuggestionMenu.EmptyItem,{className:"bn-grid-suggestion-menu-empty-item",columns:d,children:n.suggestion_menu.no_items_title})]})}function Te(e,t,n,o=3){const r=a.useRef(0);a.useEffect(()=>{t!==void 0&&(e.length>0?r.current=t.length:t.length-r.current>o&&n())},[n,o,e.length,t])}function Ve(e,t){const[n,o]=a.useState([]),[r,i]=a.useState(!1),s=a.useRef(void 0),d=a.useRef(void 0);return a.useEffect(()=>{const u=e;s.current=e,i(!0),t(e).then(c=>{s.current===u&&(o(c),i(!1),d.current=u)})},[e,t]),{items:n||[],usedQuery:d.current,loadingState:d.current===void 0?"loading-initial":r?"loading":"loaded"}}function Qt(e,t,n,o,r){const[i,s]=a.useState(0),d=o!==void 0&&o>1;return a.useEffect(()=>{var c;const u=m=>(m.key==="ArrowLeft"&&(m.preventDefault(),n.length&&s((i-1+n.length)%n.length)),m.key==="ArrowRight"&&(m.preventDefault(),n.length&&s((i+1+n.length)%n.length)),m.key==="ArrowUp"?(m.preventDefault(),n.length&&s((i-o+n.length)%n.length),!0):m.key==="ArrowDown"?(m.preventDefault(),n.length&&s((i+o)%n.length),!0):m.key==="Enter"&&!m.isComposing?(m.stopPropagation(),m.preventDefault(),n.length&&(r==null||r(n[i])),!0):!1);return(c=e.domElement)==null||c.addEventListener("keydown",u,!0),()=>{var m;(m=e.domElement)==null||m.removeEventListener("keydown",u,!0)}},[e.domElement,n,i,r,o,d]),a.useEffect(()=>{s(0)},[t]),{selectedIndex:n.length===0?void 0:i}}function en(e){const n=R().setContentEditableProps,o=x(),{getItems:r,gridSuggestionMenuComponent:i,query:s,clearQuery:d,closeMenu:u,onItemClick:c,columns:m}=e,g=a.useCallback(H=>{u(),d(),c==null||c(H)},[c,u,d]),{items:f,usedQuery:b,loadingState:w}=Ve(s,r);Te(f,b,u);const{selectedIndex:C}=Qt(o,s,f,m,g);a.useEffect(()=>(n(H=>({...H,"aria-expanded":!0,"aria-controls":"bn-suggestion-menu"})),()=>{n(H=>({...H,"aria-expanded":!1,"aria-controls":void 0}))}),[n]),a.useEffect(()=>(n(H=>({...H,"aria-activedescendant":C?"bn-suggestion-menu-item-"+C:void 0})),()=>{n(H=>({...H,"aria-activedescendant":void 0}))}),[n,C]);const M=i;return l.jsx(M,{items:f,onItemClick:g,loadingState:w,selectedIndex:C,columns:m})}function tn(e){const t=x(),{triggerCharacter:n,gridSuggestionMenuComponent:o,columns:r,minQueryLength:i,onItemClick:s,getItems:d,floatingOptions:u}=e,c=a.useMemo(()=>s||(B=>{B.onItemClick(t)}),[t,s]),m=a.useMemo(()=>d||(async B=>await Jt(t,B)),[t,d]),g={closeMenu:t.suggestionMenus.closeMenu,clearQuery:t.suggestionMenus.clearQuery},f=a.useCallback(B=>t.suggestionMenus.onUpdate(n,B),[t.suggestionMenus,n]),b=L(f),{isMounted:w,ref:C,style:M,getFloatingProps:H}=N((b==null?void 0:b.show)||!1,(b==null?void 0:b.referencePos)||null,2e3,{placement:"bottom-start",middleware:[S.offset(10),S.flip(),S.size({apply({availableHeight:B,elements:V}){Object.assign(V.floating.style,{maxHeight:`${B-10}px`})}})],onOpenChange(B){B||t.suggestionMenus.closeMenu()},...u});return!w||!b||!(b!=null&&b.ignoreQueryLength)&&i&&(b.query.startsWith(" ")||b.query.length<i)?null:l.jsx("div",{ref:C,style:M,...H(),children:l.jsx(en,{query:b.query,closeMenu:g.closeMenu,clearQuery:g.clearQuery,getItems:m,columns:r,gridSuggestionMenuComponent:o||Xo,onItemClick:c})})}function Yo(e){const t=p(),n=v(),{items:o,loadingState:r,selectedIndex:i,onItemClick:s}=e,d=r==="loading-initial"||r==="loading"?l.jsx(t.SuggestionMenu.Loader,{className:"bn-suggestion-menu-loader"}):null,u=a.useMemo(()=>{let c;const m=[];for(let g=0;g<o.length;g++){const f=o[g];f.group!==c&&(c=f.group,m.push(l.jsx(t.SuggestionMenu.Label,{className:"bn-suggestion-menu-label",children:c},c))),m.push(l.jsx(t.SuggestionMenu.Item,{className:h.mergeCSSClasses("bn-suggestion-menu-item",f.size==="small"?"bn-suggestion-menu-item-small":""),item:f,id:`bn-suggestion-menu-item-${g}`,isSelected:g===i,onClick:()=>s==null?void 0:s(f)},f.title))}return m},[t,o,s,i]);return l.jsxs(t.SuggestionMenu.Root,{id:"bn-suggestion-menu",className:"bn-suggestion-menu",children:[u,u.length===0&&(e.loadingState==="loading"||e.loadingState==="loaded")&&l.jsx(t.SuggestionMenu.EmptyItem,{className:"bn-suggestion-menu-item",children:n.suggestion_menu.no_items_title}),d]})}function nn(e,t){const[n,o]=a.useState(0);return{selectedIndex:n,setSelectedIndex:o,handler:r=>{if(r.key==="ArrowUp")return r.preventDefault(),e.length&&o((n-1+e.length)%e.length),!0;if(r.key==="ArrowDown")return r.preventDefault(),e.length&&o((n+1)%e.length),!0;const i=Jo(r)?r.nativeEvent.isComposing:r.isComposing;return r.key==="Enter"&&!i?(r.preventDefault(),r.stopPropagation(),e.length&&(t==null||t(e[n])),!0):!1}}}function Jo(e){return e.nativeEvent!==void 0}function on(e,t,n,o,r){const{selectedIndex:i,setSelectedIndex:s,handler:d}=nn(n,o);return a.useEffect(()=>{var u;return(u=r||e.domElement)==null||u.addEventListener("keydown",d,!0),()=>{var c;(c=r||e.domElement)==null||c.removeEventListener("keydown",d,!0)}},[e.domElement,n,i,o,r,d]),a.useEffect(()=>{s(0)},[t,s]),{selectedIndex:n.length===0?void 0:i}}function ln(e){const n=R().setContentEditableProps,o=x(),{getItems:r,suggestionMenuComponent:i,query:s,clearQuery:d,closeMenu:u,onItemClick:c}=e,m=a.useCallback(M=>{u(),d(),c==null||c(M)},[c,u,d]),{items:g,usedQuery:f,loadingState:b}=Ve(s,r);Te(g,f,u);const{selectedIndex:w}=on(o,s,g,m);a.useEffect(()=>(n(M=>({...M,"aria-expanded":!0,"aria-controls":"bn-suggestion-menu"})),()=>{n(M=>({...M,"aria-expanded":!1,"aria-controls":void 0}))}),[n]),a.useEffect(()=>(n(M=>({...M,"aria-activedescendant":w?"bn-suggestion-menu-item-"+w:void 0})),()=>{n(M=>({...M,"aria-activedescendant":void 0}))}),[n,w]);const C=i;return l.jsx(C,{items:g,onItemClick:m,loadingState:b,selectedIndex:w})}const Qo={heading:ne,heading_2:oe,heading_3:le,heading_4:tt,heading_5:nt,heading_6:ot,toggle_heading:ne,toggle_heading_2:oe,toggle_heading_3:le,quote:ct,toggle_list:dt,numbered_list:it,bullet_list:st,check_list:rt,paragraph:He,table:Bo,image:at,video:yo,audio:ut,file:ve,emoji:Do,code_block:xo};function rn(e){return h.getDefaultSlashMenuItems(e).map(t=>{const n=Qo[t.key];return{...t,icon:l.jsx(n,{size:18})}})}function sn(e){const t=x(),{triggerCharacter:n,suggestionMenuComponent:o,minQueryLength:r,onItemClick:i,getItems:s,floatingOptions:d}=e,u=a.useMemo(()=>i||(H=>{H.onItemClick(t)}),[t,i]),c=a.useMemo(()=>s||(async H=>h.filterSuggestionItems(rn(t),H)),[t,s]),m={closeMenu:t.suggestionMenus.closeMenu,clearQuery:t.suggestionMenus.clearQuery},g=a.useCallback(H=>t.suggestionMenus.onUpdate(n,H),[t.suggestionMenus,n]),f=L(g),{isMounted:b,ref:w,style:C,getFloatingProps:M}=N((f==null?void 0:f.show)||!1,(f==null?void 0:f.referencePos)||null,2e3,{placement:"bottom-start",middleware:[S.offset(10),S.flip({mainAxis:!0,crossAxis:!1}),S.shift(),S.size({apply({availableHeight:H,elements:B}){Object.assign(B.floating.style,{maxHeight:`${H-10}px`})}})],onOpenChange(H){H||t.suggestionMenus.closeMenu()},...d});return!b||!f||!(f!=null&&f.ignoreQueryLength)&&r&&(f.query.startsWith(" ")||f.query.length<r)?null:l.jsx("div",{ref:w,style:C,...M(),children:l.jsx(ln,{query:f.query,closeMenu:m.closeMenu,clearQuery:m.clearQuery,getItems:c,suggestionMenuComponent:o||Yo,onItemClick:u})})}const el=(e,t=.3)=>{const n=Math.floor(e)+t,o=Math.ceil(e)-t;return e>=n&&e<=o?Math.round(e):e<n?Math.floor(e):Math.ceil(e)},cn=e=>{const t=p(),n=a.useRef(!1),[o,r]=a.useState(),i=a.useCallback(d=>{e.onMouseDown(),r({originalContent:e.block.content,originalCroppedContent:{rows:e.editor.tableHandles.cropEmptyRowsOrColumns(e.block,e.orientation==="addOrRemoveColumns"?"columns":"rows")},startPos:e.orientation==="addOrRemoveColumns"?d.clientX:d.clientY}),n.current=!1,d.preventDefault()},[e]),s=a.useCallback(()=>{n.current||e.editor.updateBlock(e.block,{type:"table",content:{...e.block.content,rows:e.orientation==="addOrRemoveColumns"?e.editor.tableHandles.addRowsOrColumns(e.block,"columns",1):e.editor.tableHandles.addRowsOrColumns(e.block,"rows",1)}})},[e.block,e.orientation,e.editor]);return a.useEffect(()=>{const d=u=>{var w,C;if(!o)throw new Error("editingState is undefined");n.current=!0;const c=(e.orientation==="addOrRemoveColumns"?u.clientX:u.clientY)-o.startPos,m=e.orientation==="addOrRemoveColumns"?((w=o.originalCroppedContent.rows[0])==null?void 0:w.cells.length)??0:o.originalCroppedContent.rows.length,g=e.orientation==="addOrRemoveColumns"?((C=o.originalContent.rows[0])==null?void 0:C.cells.length)??0:o.originalContent.rows.length,f=e.orientation==="addOrRemoveColumns"?e.block.content.rows[0].cells.length:e.block.content.rows.length,b=g+el(c/(e.orientation==="addOrRemoveColumns"?h.EMPTY_CELL_WIDTH:h.EMPTY_CELL_HEIGHT),.3);b>=m&&b>0&&b!==f&&(e.editor.updateBlock(e.block,{type:"table",content:{...e.block.content,rows:e.orientation==="addOrRemoveColumns"?e.editor.tableHandles.addRowsOrColumns({type:"table",content:o.originalCroppedContent},"columns",b-m):e.editor.tableHandles.addRowsOrColumns({type:"table",content:o.originalCroppedContent},"rows",b-m)}}),e.block.content&&e.editor.setTextCursorPosition(e.block))};return o&&window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}},[o,e.block,e.editor,e.orientation]),a.useEffect(()=>{const d=e.onMouseUp,u=()=>{r(void 0),d()};return o&&window.addEventListener("mouseup",u),()=>{window.removeEventListener("mouseup",u)}},[o,e.onMouseUp]),e.editor.isEditable?l.jsx(t.TableHandle.ExtendButton,{className:h.mergeCSSClasses("bn-extend-button",e.orientation==="addOrRemoveColumns"?"bn-extend-button-add-remove-columns":"bn-extend-button-add-remove-rows",o!==null?"bn-extend-button-editing":""),onClick:s,onMouseDown:i,children:e.children||l.jsx(Eo,{size:18,"data-test":"extendButton"})}):null},be=e=>{const t=p(),n=v(),r=x().tableHandles;return r?l.jsx(t.Generic.Menu.Item,{onClick:()=>{r.addRowOrColumn(e.index,e.orientation==="row"?{orientation:"row",side:e.side}:{orientation:"column",side:e.side})},children:n.table_handle[`add_${e.side}_menuitem`]}):null},an=e=>{const t=p(),n=v(),r=x().tableHandles;return r?l.jsx(t.Generic.Menu.Item,{onClick:()=>{r.removeRowOrColumn(e.index,e.orientation)},children:e.orientation==="row"?n.table_handle.delete_row_menuitem:n.table_handle.delete_column_menuitem}):null},tl=e=>{const t=p(),n=v(),o=x(),r=o.tableHandles,i=a.useMemo(()=>!r||!e.block?[]:e.orientation==="row"?r.getCellsAtRowHandle(e.block,e.index):r.getCellsAtColumnHandle(e.block,e.index),[e.block,e.index,e.orientation,r]),s=(u,c)=>{const m=e.block.content.rows.map(g=>({...g,cells:g.cells.map(f=>h.mapTableCell(f))}));i.forEach(({row:g,col:f})=>{c==="text"?m[g].cells[f].props.textColor=u:m[g].cells[f].props.backgroundColor=u}),o.updateBlock(e.block,{type:"table",content:{...e.block.content,rows:m}}),o.setTextCursorPosition(e.block)};if(!i||!i[0]||!r||o.settings.tables.cellTextColor===!1&&o.settings.tables.cellBackgroundColor===!1)return null;const d=h.mapTableCell(i[0].cell);return l.jsxs(t.Generic.Menu.Root,{position:"right",sub:!0,children:[l.jsx(t.Generic.Menu.Trigger,{sub:!0,children:l.jsx(t.Generic.Menu.Item,{className:"bn-menu-item",subTrigger:!0,children:e.children||n.drag_handle.colors_menuitem})}),l.jsx(t.Generic.Menu.Dropdown,{sub:!0,className:"bn-menu-dropdown bn-color-picker-dropdown",children:l.jsx(se,{iconSize:18,text:o.settings.tables.cellTextColor?{color:i.every(({cell:u})=>h.isTableCell(u)&&u.props.textColor===d.props.textColor)?d.props.textColor:"default",setColor:u=>{s(u,"text")}}:void 0,background:o.settings.tables.cellBackgroundColor?{color:i.every(({cell:u})=>h.isTableCell(u)&&u.props.backgroundColor===d.props.backgroundColor)?d.props.backgroundColor:"default",setColor:u=>s(u,"background")}:void 0})})]})},nl=e=>{const t=p(),n=v(),o=x();if(!o.tableHandles||e.index!==0||e.orientation!=="row"||!o.settings.tables.headers)return null;const i=!!e.block.content.headerRows;return l.jsx(t.Generic.Menu.Item,{className:"bn-menu-item",checked:i,onClick:()=>{const s=o.getBlock(e.block.id);s&&o.updateBlock(s,{...s,content:{...s.content,headerRows:i?void 0:1}})},children:n.drag_handle.header_row_menuitem})},ol=e=>{const t=p(),n=v(),o=x();if(!o.tableHandles||e.index!==0||e.orientation!=="column"||!o.settings.tables.headers)return null;const i=!!e.block.content.headerCols;return l.jsx(t.Generic.Menu.Item,{className:"bn-menu-item",checked:i,onClick:()=>{const s=o.getBlock(e.block.id);s&&o.updateBlock(s,{...s,content:{...s.content,headerCols:i?void 0:1}})},children:n.drag_handle.header_column_menuitem})},dn=e=>{const t=p();return l.jsx(t.Generic.Menu.Dropdown,{className:"bn-table-handle-menu",children:e.children||l.jsxs(l.Fragment,{children:[l.jsx(an,{orientation:e.orientation,block:e.block,index:e.index}),l.jsx(be,{orientation:e.orientation,block:e.block,index:e.index,side:e.orientation==="row"?"above":"left"}),l.jsx(be,{orientation:e.orientation,block:e.block,index:e.index,side:e.orientation==="row"?"below":"right"}),l.jsx(nl,{orientation:e.orientation,block:e.block,index:e.index}),l.jsx(ol,{orientation:e.orientation,block:e.block,index:e.index}),l.jsx(tl,{orientation:e.orientation,block:e.block,index:e.index})]})})},un=e=>{const t=p(),[n,o]=a.useState(!1),r=e.tableHandleMenu||dn,i=a.useMemo(()=>{const s=e.editor.tableHandles;return!s||!e.block||e.block.type!=="table"?!1:e.orientation==="column"?s.getCellsAtColumnHandle(e.block,e.index).every(({cell:d})=>h.getColspan(d)===1):s.getCellsAtRowHandle(e.block,e.index).every(({cell:d})=>h.getRowspan(d)===1)},[e.block,e.editor.tableHandles,e.index,e.orientation]);return l.jsxs(t.Generic.Menu.Root,{onOpenChange:s=>{s?(e.freezeHandles(),e.hideOtherSide()):(e.unfreezeHandles(),e.showOtherSide(),e.editor.focus())},position:"right",children:[l.jsx(t.Generic.Menu.Trigger,{children:l.jsx(t.TableHandle.Root,{className:h.mergeCSSClasses("bn-table-handle",n?"bn-table-handle-dragging":"",i?"":"bn-table-handle-not-draggable"),draggable:i,onDragStart:s=>{o(!0),e.dragStart(s)},onDragEnd:()=>{e.dragEnd(),o(!1)},style:e.orientation==="column"?{transform:"rotate(0.25turn)"}:void 0,children:e.children||l.jsx(Ut,{size:24,"data-test":"tableHandle"})})}),A.createPortal(l.jsx(r,{orientation:e.orientation,block:e.block,index:e.index}),e.menuContainer)]})};function We(e,t,n){const{refs:o,update:r,context:i,floatingStyles:s}=S.useFloating({open:t,placement:e==="addOrRemoveColumns"?"right":"bottom",middleware:[S.size({apply({rects:c,elements:m}){Object.assign(m.floating.style,e==="addOrRemoveColumns"?{height:`${c.reference.height}px`}:{width:`${c.reference.width}px`})}})]}),{isMounted:d,styles:u}=S.useTransitionStyles(i);return a.useEffect(()=>{r()},[n,r]),a.useEffect(()=>{n!==null&&o.setReference({getBoundingClientRect:()=>n})},[e,n,o]),a.useMemo(()=>({isMounted:d,ref:o.setFloating,style:{display:"flex",...u,...s}}),[s,d,o.setFloating,u])}function mn(e,t,n){const o=We("addOrRemoveRows",t,n),r=We("addOrRemoveColumns",e,n);return a.useMemo(()=>({addOrRemoveRowsButton:o,addOrRemoveColumnsButton:r}),[r,o])}function ll(e,t,n){return n&&n.draggedCellOrientation==="row"?new DOMRect(t.x,n.mousePos,t.width,0):new DOMRect(t.x,e.y,t.width,e.height)}function rl(e,t,n){return n&&n.draggedCellOrientation==="col"?new DOMRect(n.mousePos,t.y,0,t.height):new DOMRect(e.x,t.y,e.width,t.height)}function il(e){return new DOMRect(e.x,e.y,e.width,0)}function fe(e,t,n,o,r){const{refs:i,update:s,context:d,floatingStyles:u}=S.useFloating({open:t,placement:e==="row"?"left":e==="col"?"top":"bottom-end",middleware:[S.offset(e==="row"?-10:e==="col"?-12:{mainAxis:1,crossAxis:-1})]}),{isMounted:c,styles:m}=S.useTransitionStyles(d);return a.useEffect(()=>{s()},[n,o,s]),a.useEffect(()=>{n===null||o===null||r&&e==="cell"||i.setReference({getBoundingClientRect:()=>(e==="row"?ll:e==="col"?rl:il)(n,o,r)})},[r,e,n,o,i]),a.useMemo(()=>({isMounted:c,ref:i.setFloating,style:{display:"flex",...m,...u}}),[u,c,i.setFloating,m])}function fn(e,t,n,o){const r=fe("row",e,t,n,o),i=fe("col",e,t,n,o),s=fe("cell",e,t,n,o);return a.useMemo(()=>({rowHandle:r,colHandle:i,cellHandle:s}),[i,r,s])}const gn=e=>{var s,d;const t=p(),n=v(),o=x(),r=(u,c)=>{const m=e.block.content.rows.map(g=>({...g,cells:g.cells.map(f=>h.mapTableCell(f))}));c==="text"?m[e.rowIndex].cells[e.colIndex].props.textColor=u:m[e.rowIndex].cells[e.colIndex].props.backgroundColor=u,o.updateBlock(e.block,{type:"table",content:{...e.block.content,rows:m}}),o.setTextCursorPosition(e.block)},i=(d=(s=e.block.content.rows[e.rowIndex])==null?void 0:s.cells)==null?void 0:d[e.colIndex];return!i||o.settings.tables.cellTextColor===!1&&o.settings.tables.cellBackgroundColor===!1?null:l.jsxs(t.Generic.Menu.Root,{position:"right",sub:!0,children:[l.jsx(t.Generic.Menu.Trigger,{sub:!0,children:l.jsx(t.Generic.Menu.Item,{className:"bn-menu-item",subTrigger:!0,children:e.children||n.drag_handle.colors_menuitem})}),l.jsx(t.Generic.Menu.Dropdown,{sub:!0,className:"bn-menu-dropdown bn-color-picker-dropdown",children:l.jsx(se,{iconSize:18,text:o.settings.tables.cellTextColor?{color:h.isTableCell(i)?i.props.textColor:"default",setColor:u=>r(u,"text")}:void 0,background:o.settings.tables.cellBackgroundColor?{color:h.isTableCell(i)?i.props.backgroundColor:"default",setColor:u=>r(u,"background")}:void 0})})]})},hn=e=>{var i,s;const t=p(),n=v(),o=x(),r=(s=(i=e.block.content.rows[e.rowIndex])==null?void 0:i.cells)==null?void 0:s[e.colIndex];return!r||!h.isTableCell(r)||h.getRowspan(r)===1&&h.getColspan(r)===1||!o.settings.tables.splitCells?null:l.jsx(t.Generic.Menu.Item,{onClick:()=>{var d;(d=o.tableHandles)==null||d.splitCell({row:e.rowIndex,col:e.colIndex})},children:n.table_handle.split_cell_menuitem})},bn=e=>{const t=p();return l.jsx(t.Generic.Menu.Dropdown,{className:"bn-menu-dropdown bn-drag-handle-menu",children:e.children||l.jsxs(l.Fragment,{children:[l.jsx(hn,{block:e.block,rowIndex:e.rowIndex,colIndex:e.colIndex}),l.jsx(gn,{block:e.block,rowIndex:e.rowIndex,colIndex:e.colIndex})]})})},Cn=e=>{const t=p(),n=e.tableCellMenu||bn;return!e.editor.settings.tables.splitCells&&!e.editor.settings.tables.cellBackgroundColor&&!e.editor.settings.tables.cellTextColor?null:l.jsxs(t.Generic.Menu.Root,{onOpenChange:o=>{o?e.freezeHandles():(e.unfreezeHandles(),e.editor.focus())},position:"right",children:[l.jsx(t.Generic.Menu.Trigger,{children:l.jsx(t.Generic.Menu.Button,{className:"bn-table-cell-handle",children:e.children||l.jsx(Ko,{size:12,"data-test":"tableCellHandle"})})}),A.createPortal(l.jsx(n,{block:e.block,rowIndex:e.rowIndex,colIndex:e.colIndex}),e.menuContainer)]})},xn=e=>{var O,T;const t=x(),[n,o]=a.useState(null);if(!t.tableHandles)throw new Error("TableHandlesController can only be used when BlockNote editor schema contains table block");const r={rowDragStart:t.tableHandles.rowDragStart,colDragStart:t.tableHandles.colDragStart,dragEnd:t.tableHandles.dragEnd,freezeHandles:t.tableHandles.freezeHandles,unfreezeHandles:t.tableHandles.unfreezeHandles},{freezeHandles:i,unfreezeHandles:s}=r,d=a.useCallback(()=>{i(),V(!0),H(!0)},[i]),u=a.useCallback(()=>{s(),V(!1),H(!1)},[s]),c=L(t.tableHandles.onUpdate.bind(t.tableHandles)),m=a.useMemo(()=>{var I,X;return c!=null&&c.draggingState?{draggedCellOrientation:(I=c==null?void 0:c.draggingState)==null?void 0:I.draggedCellOrientation,mousePos:(X=c==null?void 0:c.draggingState)==null?void 0:X.mousePos}:void 0},[c==null?void 0:c.draggingState,(O=c==null?void 0:c.draggingState)==null?void 0:O.draggedCellOrientation,(T=c==null?void 0:c.draggingState)==null?void 0:T.mousePos]),{rowHandle:g,colHandle:f,cellHandle:b}=fn((c==null?void 0:c.show)||!1,(c==null?void 0:c.referencePosCell)||null,(c==null?void 0:c.referencePosTable)||null,m),{addOrRemoveColumnsButton:w,addOrRemoveRowsButton:C}=mn((c==null?void 0:c.showAddOrRemoveColumnsButton)||!1,(c==null?void 0:c.showAddOrRemoveRowsButton)||!1,(c==null?void 0:c.referencePosTable)||null),[M,H]=a.useState(!1),[B,V]=a.useState(!1);if(!c)return null;const P=e.tableHandle||un,D=e.extendButton||cn,_=e.tableCellHandle||Cn;return l.jsxs(l.Fragment,{children:[l.jsx("div",{ref:o}),l.jsxs(S.FloatingPortal,{root:c.widgetContainer,children:[!M&&n&&g.isMounted&&c.rowIndex!==void 0&&l.jsx("div",{ref:g.ref,style:g.style,children:l.jsx(P,{editor:t,orientation:"row",showOtherSide:()=>V(!1),hideOtherSide:()=>V(!0),index:c.rowIndex,block:c.block,dragStart:r.rowDragStart,dragEnd:r.dragEnd,freezeHandles:r.freezeHandles,unfreezeHandles:r.unfreezeHandles,menuContainer:n})}),!B&&n&&f.isMounted&&c.colIndex!==void 0&&l.jsx("div",{ref:f.ref,style:f.style,children:l.jsx(P,{editor:t,orientation:"column",showOtherSide:()=>H(!1),hideOtherSide:()=>H(!0),index:c.colIndex,block:c.block,dragStart:r.colDragStart,dragEnd:r.dragEnd,freezeHandles:r.freezeHandles,unfreezeHandles:r.unfreezeHandles,menuContainer:n})}),n&&b.isMounted&&c.colIndex!==void 0&&c.rowIndex!==void 0&&l.jsx("div",{ref:b.ref,style:b.style,children:l.jsx(_,{editor:t,block:c.block,rowIndex:c.rowIndex,colIndex:c.colIndex,menuContainer:n,freezeHandles:r.freezeHandles,unfreezeHandles:r.unfreezeHandles})}),l.jsx("div",{ref:C.ref,style:C.style,children:l.jsx(D,{editor:t,orientation:"addOrRemoveRows",block:c.block,onMouseDown:d,onMouseUp:u})}),l.jsx("div",{ref:w.ref,style:w.style,children:l.jsx(D,{editor:t,orientation:"addOrRemoveColumns",block:c.block,onMouseDown:d,onMouseUp:u})})]})]})};function pn(e){const t=x();if(!t)throw new Error("BlockNoteDefaultUI must be used within a BlockNoteContext.Provider");return l.jsxs(l.Fragment,{children:[e.formattingToolbar!==!1&&l.jsx(Nt,{}),e.linkToolbar!==!1&&l.jsx(Ot,{}),e.slashMenu!==!1&&l.jsx(sn,{triggerCharacter:"/"}),e.emojiPicker!==!1&&l.jsx(tn,{triggerCharacter:":",columns:10,minQueryLength:2}),e.sideMenu!==!1&&l.jsx(Yt,{}),t.filePanel&&e.filePanel!==!1&&l.jsx(xt,{}),t.tableHandles&&e.tableHandles!==!1&&l.jsx(xn,{}),t.comments&&e.comments!==!1&&l.jsxs(l.Fragment,{children:[l.jsx(Ye,{}),l.jsx(ht,{})]})]})}const kn=()=>{const e=a.useMemo(()=>{var s;return(s=window.matchMedia)==null?void 0:s.call(window,"(prefers-color-scheme: dark)")},[]),t=a.useMemo(()=>{var s;return(s=window.matchMedia)==null?void 0:s.call(window,"(prefers-color-scheme: light)")},[]),n=e==null?void 0:e.matches,o=t==null?void 0:t.matches,[r,i]=a.useState(n?"dark":o?"light":"no-preference");return a.useEffect(()=>{i(n?"dark":o?"light":"no-preference")},[n,o]),a.useEffect(()=>{if(typeof(e==null?void 0:e.addEventListener)=="function"){const s=({matches:u})=>u&&i("dark"),d=({matches:u})=>u&&i("light");return e==null||e.addEventListener("change",s),t==null||t.addEventListener("change",d),()=>{e==null||e.removeEventListener("change",s),t==null||t.removeEventListener("change",d)}}else{const s=()=>i(e.matches?"dark":t.matches?"light":"no-preference");return e==null||e.addEventListener("change",s),t==null||t.addEventListener("change",s),()=>{e==null||e.removeEventListener("change",s),t==null||t.removeEventListener("change",s)}}},[e,t]),typeof window.matchMedia!="function",r},wn=a.createContext(void 0);function sl(){return a.useContext(wn)}function cl(){const e=new Set;let t={};return{subscribe(n){return e.add(n),()=>{e.delete(n)}},getSnapshot(){return t},getServerSnapshot(){return t},setRenderer(n,o){t={...t,[n]:A.createPortal(o.reactElement,o.element,n)},e.forEach(r=>r())},removeRenderer(n){const o={...t};delete o[n],t=o,e.forEach(r=>r())}}}const al=({contentComponent:e})=>{const t=a.useSyncExternalStore(e.subscribe,e.getSnapshot,e.getServerSnapshot);return l.jsx(l.Fragment,{children:Object.values(t)})},dl=a.forwardRef((e,t)=>{const[n,o]=a.useState();return a.useImperativeHandle(t,()=>(r,i)=>{A.flushSync(()=>{o({node:r,container:i})}),o(void 0)},[]),l.jsx(l.Fragment,{children:n&&A.createPortal(n.node,n.container)})}),qe=()=>{};function ul(e,t){const{editor:n,className:o,theme:r,children:i,editable:s,onSelectionChange:d,onChange:u,formattingToolbar:c,linkToolbar:m,slashMenu:g,emojiPicker:f,sideMenu:b,filePanel:w,tableHandles:C,comments:M,autoFocus:H,renderEditor:B=!n.headless,...V}=e,[P,D]=a.useState(),_=R(),O=kn(),T=(_==null?void 0:_.colorSchemePreference)||O,I=r||(T==="dark"?"dark":"light");U(u||qe,n),W(d||qe,n),a.useEffect(()=>{n.isEditable=s!==!1},[s,n]);const X=a.useCallback(On=>{n.elementRenderer=On},[n]),Dn=a.useMemo(()=>({..._,editor:n,setContentEditableProps:D}),[_,n]),Zn=a.useMemo(()=>({editorProps:{autoFocus:H,contentEditableProps:P},defaultUIProps:{formattingToolbar:c,linkToolbar:m,slashMenu:g,emojiPicker:f,sideMenu:b,filePanel:w,tableHandles:C,comments:M}}),[H,P,c,m,g,f,b,w,C,M]);return l.jsx(pe.Provider,{value:Dn,children:l.jsxs(wn.Provider,{value:Zn,children:[l.jsx(dl,{ref:X}),l.jsx(ml,{className:o,renderEditor:B,editorColorScheme:I,ref:t,...V,children:i})]})})}const ml=E.default.forwardRef(({className:e,renderEditor:t,editorColorScheme:n,children:o,...r},i)=>l.jsx("div",{className:h.mergeCSSClasses("bn-container",n,e),"data-color-scheme":n,...r,ref:i,children:t?l.jsx(vn,{children:o}):o})),fl=E.default.forwardRef(ul),vn=e=>{const t=sl(),n=x(),o=a.useMemo(()=>cl(),[]),r=a.useCallback(i=>{n.mount(i,o)},[n,o]);return l.jsxs(l.Fragment,{children:[l.jsx(al,{contentComponent:o}),l.jsx(gl,{...t.editorProps,...e,mount:r}),l.jsx(pn,{...t.defaultUIProps}),e.children]})},gl=e=>{const{autoFocus:t,mount:n,contentEditableProps:o}=e;return l.jsx("div",{"aria-autocomplete":"list","aria-haspopup":"listbox","data-bn-autofocus":t,ref:n,...o})};function re(e,t){let n;const o=document.createElement("div");let r;if(t!=null&&t.elementRenderer)t.elementRenderer(e(u=>n=u||void 0),o);else{if(!(t!=null&&t.headless))throw new Error("elementRenderer not available, expected headless editor");r=Xn.createRoot(o),A.flushSync(()=>{r.render(e(u=>n=u||void 0))})}if(!o.childElementCount)return console.warn("ReactInlineContentSpec: renderHTML() failed"),{dom:document.createElement("span")};n==null||n.setAttribute("data-tmp-find","true");const i=o.cloneNode(!0),s=i.firstElementChild,d=i.querySelector("[data-tmp-find]");return d==null||d.removeAttribute("data-tmp-find"),r==null||r.unmount(),{dom:s,contentDOM:d||void 0}}function Q(e){var t;return l.jsx(Z.NodeViewWrapper,{onDragOver:n=>n.preventDefault(),...Object.fromEntries(Object.entries(e.domAttributes||{}).filter(([n])=>n!=="class")),className:h.mergeCSSClasses("bn-block-content",((t=e.domAttributes)==null?void 0:t.class)||""),"data-content-type":e.blockType,...Object.fromEntries(Object.entries(e.blockProps).filter(([n,o])=>{const r=e.propSchema[n];return!h.inheritedProps.includes(n)&&o!==r.default}).map(([n,o])=>[h.camelToDataKebab(n),o])),"data-file-block":e.isFileBlock===!0||void 0,children:e.children})}function $(e,t){const n=h.createStronglyTypedTiptapNode({name:e.type,content:e.content==="inline"?"inline*":"",group:"blockContent",selectable:e.isSelectable??!0,isolating:!0,addAttributes(){return h.propsToAttributes(e.propSchema)},parseHTML(){return h.getParseRules(e,t.parse)},renderHTML({HTMLAttributes:o}){const r=document.createElement("div");return h.wrapInBlockStructure({dom:r,contentDOM:e.content==="inline"?r:void 0},e.type,{},e.propSchema,e.isFileBlock,o)},addNodeView(){return o=>{const r=Z.ReactNodeViewRenderer(i=>{var g;const s=this.options.editor,d=h.getBlockFromPos(i.getPos,s,this.editor,e.type),u=((g=this.options.domAttributes)==null?void 0:g.blockContent)||{},c=Z.useReactNodeView().nodeViewContentRef;if(!c)throw new Error("nodeViewContentRef is not set");const m=t.render;return l.jsx(Q,{blockType:d.type,blockProps:d.props,propSchema:e.propSchema,isFileBlock:e.isFileBlock,domAttributes:u,children:l.jsx(m,{block:d,editor:s,contentRef:f=>{c(f),f&&(f.className=h.mergeCSSClasses("bn-inline-content",f.className))}})})},{className:"bn-react-node-view-renderer"})(o);return e.isSelectable===!1&&h.applyNonSelectableBlockFix(r,this.editor),r}}});return h.createInternalBlockSpec(e,{node:n,toInternalHTML:(o,r)=>{var u;const i=((u=n.options.domAttributes)==null?void 0:u.blockContent)||{},s=t.render;return re(c=>l.jsx(Q,{blockType:o.type,blockProps:o.props,propSchema:e.propSchema,domAttributes:i,children:l.jsx(s,{block:o,editor:r,contentRef:m=>{c(m),m&&(m.className=h.mergeCSSClasses("bn-inline-content",m.className))}})}),r)},toExternalHTML:(o,r)=>{var u;const i=((u=n.options.domAttributes)==null?void 0:u.blockContent)||{},s=t.toExternalHTML||t.render;return re(c=>l.jsx(Q,{blockType:o.type,blockProps:o.props,propSchema:e.propSchema,domAttributes:i,children:l.jsx(s,{block:o,editor:r,contentRef:m=>{c(m),m&&(m.className=h.mergeCSSClasses("bn-inline-content",m.className))}})}),r)}})}function ce(e){const t=x(),[n,o]=a.useState("loading"),[r,i]=a.useState();if(a.useEffect(()=>{let s=!0;return(async()=>{let d="";o("loading");try{d=t.resolveFileUrl?await t.resolveFileUrl(e):e}catch{o("error");return}s&&(o("loaded"),i(d))})(),()=>{s=!1}},[t,e]),n!=="loaded")return{loadingState:n};if(!r)throw new Error("Finished fetching file but did not get download URL.");return{loadingState:n,downloadUrl:r}}const ae=e=>l.jsxs("figure",{children:[e.children,l.jsx("figcaption",{children:e.caption})]});function Hn(e){const t=x();a.useEffect(()=>t.onUploadEnd(e),[e,t])}function Mn(e){const t=x();a.useEffect(()=>t.onUploadStart(e),[e,t])}function Le(e){const[t,n]=a.useState(!1);return Mn(o=>{o===e&&n(!0)}),Hn(o=>{o===e&&n(!1)}),t}const Sn=e=>{const t=v(),n=a.useCallback(r=>{r.preventDefault()},[]),o=a.useCallback(()=>{e.editor.transact(r=>r.setMeta(e.editor.filePanel.plugins[0],{block:e.block}))},[e.block,e.editor]);return l.jsxs("div",{className:"bn-add-file-button",onMouseDown:n,onClick:o,children:[l.jsx("div",{className:"bn-add-file-button-icon",children:e.buttonIcon||l.jsx(ve,{size:24})}),l.jsx("div",{className:"bn-add-file-button-text",children:e.buttonText||t.file_blocks.file.add_button_text})]})},Bn=e=>l.jsxs("div",{className:"bn-file-name-with-icon",contentEditable:!1,draggable:!1,children:[l.jsx("div",{className:"bn-file-icon",children:l.jsx(ve,{size:24})}),l.jsx("p",{className:"bn-file-name",children:e.block.props.name})]}),de=e=>{const t=Le(e.block.id);return l.jsx("div",{className:"bn-file-block-content-wrapper",onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,style:e.style,children:t?l.jsx("div",{className:"bn-file-loading-preview",children:"Loading..."}):e.block.props.url===""?l.jsx(Sn,{...e}):l.jsxs(l.Fragment,{children:[e.block.props.showPreview===!1||!e.children?l.jsx(Bn,{...e}):e.children,e.block.props.caption&&l.jsx("p",{className:"bn-file-caption",children:e.block.props.caption})]})})},K=e=>l.jsxs("div",{children:[e.children,l.jsx("p",{children:e.caption})]}),jn=e=>{const t=ce(e.block.props.url);return l.jsx("audio",{className:"bn-audio",src:t.loadingState==="loading"?e.block.props.url:t.downloadUrl,controls:!0,contentEditable:!1,draggable:!1})},yn=e=>{if(!e.block.props.url)return l.jsx("p",{children:"Add audio"});const t=e.block.props.showPreview?l.jsx("audio",{src:e.block.props.url}):l.jsx("a",{href:e.block.props.url,children:e.block.props.name||e.block.props.url});return e.block.props.caption?e.block.props.showPreview?l.jsx(ae,{caption:e.block.props.caption,children:t}):l.jsx(K,{caption:e.block.props.caption,children:t}):t},Tn=e=>l.jsx(de,{...e,buttonText:e.editor.dictionary.file_blocks.audio.add_button_text,buttonIcon:l.jsx(ut,{size:24}),children:l.jsx(jn,{...e})}),hl=$(h.audioBlockConfig,{render:Tn,parse:h.audioParse,toExternalHTML:yn}),Vn=e=>{if(!e.block.props.url)return l.jsx("p",{children:"Add file"});const t=l.jsx("a",{href:e.block.props.url,children:e.block.props.name||e.block.props.url});return e.block.props.caption?l.jsx(K,{caption:e.block.props.caption,children:t}):t},Ln=e=>l.jsx(de,{...e}),bl=$(h.fileBlockConfig,{render:Ln,parse:h.fileParse,toExternalHTML:Vn}),Ee=e=>{const[t,n]=a.useState(void 0),[o,r]=a.useState(e.block.props.previewWidth),[i,s]=a.useState(!1),d=a.useRef(null);a.useEffect(()=>{const b=C=>{var B,V;let M;e.block.props.textAlignment==="center"?t.handleUsed==="left"?M=t.initialWidth+(t.initialClientX-C.clientX)*2:M=t.initialWidth+(C.clientX-t.initialClientX)*2:t.handleUsed==="left"?M=t.initialWidth+t.initialClientX-C.clientX:M=t.initialWidth+C.clientX-t.initialClientX,r(Math.min(Math.max(M,64),((V=(B=e.editor.domElement)==null?void 0:B.firstElementChild)==null?void 0:V.clientWidth)||Number.MAX_VALUE))},w=()=>{n(void 0),e.editor.updateBlock(e.block,{props:{previewWidth:o}})};return t&&(window.addEventListener("mousemove",b),window.addEventListener("mouseup",w)),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",w)}},[e,t,o]);const u=a.useCallback(()=>{e.editor.isEditable&&s(!0)},[e.editor.isEditable]),c=a.useCallback(()=>{s(!1)},[]),m=a.useCallback(b=>{b.preventDefault(),n({handleUsed:"left",initialWidth:d.current.clientWidth,initialClientX:b.clientX})},[]),g=a.useCallback(b=>{b.preventDefault(),n({handleUsed:"right",initialWidth:d.current.clientWidth,initialClientX:b.clientX})},[]),f=Le(e.block.id);return l.jsx(de,{...e,onMouseEnter:u,onMouseLeave:c,style:e.block.props.url&&!f&&e.block.props.showPreview?{width:o?`${o}px`:"fit-content"}:void 0,children:l.jsxs("div",{className:"bn-visual-media-wrapper",ref:d,children:[e.children,(i||t)&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"bn-resize-handle",style:{left:"4px"},onMouseDown:m}),l.jsx("div",{className:"bn-resize-handle",style:{right:"4px"},onMouseDown:g})]})]})})},En=e=>{const t=ce(e.block.props.url);return l.jsx("img",{className:"bn-visual-media",src:t.loadingState==="loading"?e.block.props.url:t.downloadUrl,alt:e.block.props.caption||"BlockNote image",contentEditable:!1,draggable:!1})},Rn=e=>{if(!e.block.props.url)return l.jsx("p",{children:"Add image"});const t=e.block.props.showPreview?l.jsx("img",{src:e.block.props.url,alt:e.block.props.name||e.block.props.caption||"BlockNote image",width:e.block.props.previewWidth}):l.jsx("a",{href:e.block.props.url,children:e.block.props.name||e.block.props.url});return e.block.props.caption?e.block.props.showPreview?l.jsx(ae,{caption:e.block.props.caption,children:t}):l.jsx(K,{caption:e.block.props.caption,children:t}):t},_n=e=>l.jsx(Ee,{...e,buttonText:e.editor.dictionary.file_blocks.image.add_button_text,buttonIcon:l.jsx(at,{size:24}),children:l.jsx(En,{...e})}),Cl=$(h.imageBlockConfig,{render:_n,parse:h.imageParse,toExternalHTML:Rn});function xl(e){return k({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 3v4a1 1 0 0 0 1 1h4"},child:[]},{tag:"path",attr:{d:"M19 18v1a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-1"},child:[]},{tag:"path",attr:{d:"M3 14h3m4.5 0h3m4.5 0h3"},child:[]},{tag:"path",attr:{d:"M5 10v-5a2 2 0 0 1 2 -2h7l5 5v2"},child:[]}]})(e)}const pl={page_break:xl};function kl(e){return h.getPageBreakSlashMenuItems(e).map(t=>{const n=pl[t.key];return{...t,icon:l.jsx(n,{size:18})}})}const In=e=>{const t=ce(e.block.props.url);return l.jsx("video",{className:"bn-visual-media",src:t.loadingState==="loading"?e.block.props.url:t.downloadUrl,controls:!0,contentEditable:!1,draggable:!1})},Nn=e=>{if(!e.block.props.url)return l.jsx("p",{children:"Add video"});const t=e.block.props.showPreview?l.jsx("video",{src:e.block.props.url}):l.jsx("a",{href:e.block.props.url,children:e.block.props.name||e.block.props.url});return e.block.props.caption?e.block.props.showPreview?l.jsx(ae,{caption:e.block.props.caption,children:t}):l.jsx(K,{caption:e.block.props.caption,children:t}):t},Fn=e=>l.jsx(Ee,{...e,buttonText:e.editor.dictionary.file_blocks.video.add_button_text,buttonIcon:l.jsx(Lo,{size:24}),children:l.jsx(In,{...e})}),wl=$(h.videoBlockConfig,{render:Fn,parse:h.videoParse,toExternalHTML:Nn}),vl=(e,t)=>{if(t.type==="toggled")return!e;if(t.type==="childAdded")return!0;if(t.type==="lastChildRemoved")return!1;throw new h.UnreachableCaseError(t)},Hl=e=>{const{block:t,editor:n,children:o,toggledState:r}=e,[i,s]=a.useReducer(vl,(r||h.defaultToggledState).get(t)),[d,u]=a.useState(t.children.length),c=f=>{(r||h.defaultToggledState).set(n.getBlock(f),!i),s({type:"toggled"})},m=f=>{(r||h.defaultToggledState).set(f,!0),s({type:"childAdded"})},g=f=>{(r||h.defaultToggledState).set(f,!1),s({type:"lastChildRemoved"})};return U(()=>{if("isToggleable"in t.props&&!t.props.isToggleable)return;const f=n.getBlock(t),b=f.children.length??0;b>d?i||m(f):b===0&&b<d&&i&&g(f),u(b)}),"isToggleable"in t.props&&!t.props.isToggleable?o:l.jsxs("div",{children:[l.jsxs("div",{className:"bn-toggle-wrapper","data-show-children":i,children:[l.jsx("button",{className:"bn-toggle-button",type:"button",onMouseDown:f=>f.preventDefault(),onClick:()=>c(n.getBlock(t)),children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",viewBox:"0 -960 960 960",width:"1em",fill:"currentcolor",children:l.jsx("path",{d:"M472-480 332-620q-18-18-18-44t18-44q18-18 44-18t44 18l183 183q9 9 14 21t5 24q0 12-5 24t-14 21L420-252q-18 18-44 18t-44-18q-18-18-18-44t18-44l140-140Z"})})}),o]}),i&&d===0&&l.jsx("button",{className:"bn-toggle-add-block-button",type:"button",onClick:()=>{const f=n.updateBlock(t,{children:[{}]});n.setTextCursorPosition(f.children[0].id,"end"),n.focus()},children:"Empty toggle. Click to add a block."})]})},Ml=e=>{const[t,n]=a.useState("none"),o=a.useRef(null),r=x(),i=L(r.formattingToolbar.onUpdate.bind(r.formattingToolbar)),s=a.useMemo(()=>({display:"flex",position:"fixed",bottom:0,zIndex:3e3,transform:t}),[t]);if(a.useEffect(()=>{const u=window.visualViewport;function c(){const m=document.body,g=u.offsetLeft,f=u.height-m.getBoundingClientRect().height+u.offsetTop;n(`translate(${g}px, ${f}px) scale(${1/u.scale})`)}return window.visualViewport.addEventListener("scroll",c),window.visualViewport.addEventListener("resize",c),c(),()=>{window.visualViewport.removeEventListener("scroll",c),window.visualViewport.removeEventListener("resize",c)}},[]),!i)return null;if(!i.show&&o.current)return l.jsx("div",{ref:o,style:s,dangerouslySetInnerHTML:{__html:o.current.innerHTML}});const d=e.formattingToolbar||ye;return l.jsx("div",{ref:o,style:s,children:l.jsx(d,{})})},Sl=E.default.memo(({thread:e,selectedThreadId:t,editor:n,maxCommentsBeforeCollapse:o,referenceText:r})=>{const i=a.useCallback(d=>{var u;d.target.closest(".bn-action-toolbar")||(u=n.comments)==null||u.selectThread(e.id)},[n.comments,e.id]),s=a.useCallback(d=>{var m;if(!d.relatedTarget||d.relatedTarget.closest(".bn-action-toolbar"))return;const u=d.target instanceof Node?d.target:null,c=d.relatedTarget instanceof Node?d.relatedTarget.closest(".bn-thread"):null;(!u||!c||!c.contains(u))&&((m=n.comments)==null||m.selectThread(void 0))},[n.comments]);return l.jsx(Me,{thread:e,selected:e.id===t,referenceText:r,maxCommentsBeforeCollapse:o,onFocus:i,onBlur:s,tabIndex:0})});function Bl(e,t,n){if(t==="recent-activity")return e.sort((o,r)=>r.comments[r.comments.length-1].createdAt.getTime()-o.comments[o.comments.length-1].createdAt.getTime());if(t==="oldest")return e.sort((o,r)=>o.createdAt.getTime()-r.createdAt.getTime());if(t==="position")return e.sort((o,r)=>{var d,u;const i=((d=n==null?void 0:n.get(o.id))==null?void 0:d.from)||Number.MAX_VALUE,s=((u=n==null?void 0:n.get(r.id))==null?void 0:u.from)||Number.MAX_VALUE;return i-s});throw new h.UnreachableCaseError(t)}function Ce(e,t){return e.transact(n=>{if(!t)return"Original content deleted";if(n.doc.nodeSize<t.to)return"";const o=n.doc.textBetween(t.from,t.to);return o.length>15?`${o.slice(0,15)}`:o})}function jl(e){const t=x();if(!t.comments)throw new Error("Comments plugin not found");const n=L(t.comments.onUpdate.bind(t.comments)),o=n==null?void 0:n.selectedThreadId,r=Se(t),i=a.useMemo(()=>{const s=Array.from(r.values()),d=Bl(s,e.sort||"position",n==null?void 0:n.threadPositions),u=[];for(const c of d)c.resolved?(e.filter==="resolved"||e.filter==="all")&&u.push({thread:c,referenceText:Ce(t,n==null?void 0:n.threadPositions.get(c.id))}):(e.filter==="open"||e.filter==="all")&&u.push({thread:c,referenceText:Ce(t,n==null?void 0:n.threadPositions.get(c.id))});return u},[r,n==null?void 0:n.threadPositions,e.filter,e.sort,t]);return l.jsx("div",{className:"bn-threads-sidebar",children:i.map(s=>l.jsx(Sl,{thread:s.thread,selectedThreadId:o,editor:t,referenceText:s.referenceText,maxCommentsBeforeCollapse:e.maxCommentsBeforeCollapse},s.thread.id))})}function yl(e){const t=R();if(e||(e=t==null?void 0:t.editor),!e)throw new Error("'editor' is required, either from BlockNoteContext or as a function argument");const n=e,[o,r]=a.useState(()=>n.getActiveStyles()),i=a.useCallback(()=>{r(n.getActiveStyles())},[n]);return U(i,n),W(i,n),o}function Tl(){const[,e]=a.useState(0);return()=>e(t=>t+1)}const Vl=e=>{const t=Tl();a.useEffect(()=>{const n=()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t()})})};return e.on("transaction",n),()=>{e.off("transaction",n)}},[e])};function Ll(e){return e.currentTarget instanceof HTMLElement&&e.relatedTarget instanceof HTMLElement?e.currentTarget.contains(e.relatedTarget):!1}function El({onBlur:e,onFocus:t}={}){const n=a.useRef(null),[o,r]=a.useState(!1),i=a.useRef(!1),s=c=>{r(c),i.current=c},d=c=>{i.current||(s(!0),t==null||t(c))},u=c=>{i.current&&!Ll(c)&&(s(!1),e==null||e(c))};return a.useEffect(()=>{const c=n.current;if(c)return c.addEventListener("focusin",d),c.addEventListener("focusout",u),()=>{c==null||c.removeEventListener("focusin",d),c==null||c.removeEventListener("focusout",u)}},[d,u]),{ref:n,focused:o}}function Pn(e){return l.jsx(Z.NodeViewWrapper,{as:"span",className:"bn-inline-content-section","data-inline-content-type":e.inlineContentType,...Object.fromEntries(Object.entries(e.inlineContentProps).filter(([t,n])=>{const o=e.propSchema[t];return n!==o.default}).map(([t,n])=>[h.camelToDataKebab(t),n])),children:e.children})}function Rl(e,t){const n=h.createStronglyTypedTiptapNode({name:e.type,inline:!0,group:"inline",selectable:e.content==="styled",atom:e.content==="none",draggable:e.draggable,content:e.content==="styled"?"inline*":"",addAttributes(){return h.propsToAttributes(e.propSchema)},addKeyboardShortcuts(){return h.addInlineContentKeyboardShortcuts(e)},parseHTML(){return h.getInlineContentParseRules(e)},renderHTML({node:o}){const r=this.options.editor,i=h.nodeToCustomInlineContent(o,r.schema.inlineContentSchema,r.schema.styleSchema),s=t.render,d=re(u=>l.jsx(s,{inlineContent:i,updateInlineContent:()=>{},editor:r,contentRef:u}),r);return h.addInlineContentAttributes(d,e.type,o.attrs,e.propSchema)},addNodeView(){const o=this.options.editor;return r=>Z.ReactNodeViewRenderer(i=>{const s=Z.useReactNodeView().nodeViewContentRef;if(!s)throw new Error("nodeViewContentRef is not set");const d=t.render;return l.jsx(Pn,{inlineContentProps:i.node.attrs,inlineContentType:e.type,propSchema:e.propSchema,children:l.jsx(d,{contentRef:s,editor:o,inlineContent:h.nodeToCustomInlineContent(i.node,o.schema.inlineContentSchema,o.schema.styleSchema),updateInlineContent:u=>{const c=h.inlineContentToNodes([u],o.pmSchema);o.transact(m=>m.replaceWith(i.getPos(),i.getPos()+i.node.nodeSize,c))}})})},{className:"bn-ic-react-node-view-renderer",as:"span"})(r)}});return h.createInternalInlineContentSpec(e,{node:n})}var z,xe;class _l{constructor({mark:t,view:n,inline:o,options:r,editor:i}){Ie(this,z);j(this,"dom");j(this,"contentDOM");j(this,"mark");j(this,"view");j(this,"inline");j(this,"options");j(this,"editor");j(this,"shouldIgnoreMutation",t=>!this.dom||!this.contentDOM?!0:t.type==="selection"?!1:this.contentDOM===t.target&&t.type==="attributes"?!0:!this.contentDOM.contains(t.target));j(this,"ignoreMutation",t=>{if(!this.dom||!this.contentDOM)return!0;let n;const o=this.options.ignoreMutation;return o&&(n=o(t)),typeof n!="boolean"&&(n=this.shouldIgnoreMutation(t)),n});this.mark=t,this.view=n,this.inline=o,this.options=r,this.editor=i,this.dom=this.createDOM(r.as),this.contentDOM=r.contentAs?this.createContentDOM(r.contentAs):void 0,this.dom.setAttribute("data-mark-view-root","true"),this.contentDOM&&(this.contentDOM.setAttribute("data-mark-view-content","true"),this.contentDOM.style.whiteSpace="inherit")}createDOM(t){return me(this,z,xe).call(this,t)}createContentDOM(t){return me(this,z,xe).call(this,t)}get component(){return this.options.component}destroy(){var t,n,o;(n=(t=this.options).destroy)==null||n.call(t),this.dom.remove(),(o=this.contentDOM)==null||o.remove()}}z=new WeakSet,xe=function(t){const{inline:n,mark:o}=this;return t==null?document.createElement(n?"span":"div"):t instanceof HTMLElement?t:t instanceof Function?t(o):document.createElement(t)};class Il extends _l{constructor(){super(...arguments);j(this,"id",Math.floor(Math.random()*4294967295).toString());j(this,"context",{contentRef:n=>{n&&this.contentDOM&&n.firstChild!==this.contentDOM&&n.appendChild(this.contentDOM)},view:this.view,mark:this.mark});j(this,"updateContext",()=>{Object.assign(this.context,{mark:this.mark})});j(this,"render",()=>{this.editor._tiptapEditor.contentComponent.setRenderer(this.id,this.renderer())});j(this,"destroy",()=>{super.destroy(),this.editor._tiptapEditor.contentComponent.removeRenderer(this.id)});j(this,"renderer",()=>{const n=this.component,o={};return this.mark.attrs.stringValue&&(o.value=this.mark.attrs.stringValue),{reactElement:l.jsx(n,{contentRef:this.context.contentRef,...o}),element:this.dom}})}}function Nl(e,t){const n=Z.Mark.create({name:e.type,addAttributes(){return h.stylePropsToAttributes(e.propSchema)},parseHTML(){return h.getStyleParseRules(e)},renderHTML({mark:o}){const r={};e.propSchema==="string"&&(r.value=o.attrs.stringValue);const i=t.render,s=re(d=>l.jsx(i,{...r,contentRef:d}),this.options.editor);return h.addStyleAttributes(s,e.type,o.attrs.stringValue,e.propSchema)}});return n.config.addMarkView=o=>(r,i)=>{const s=new Il({editor:o,inline:!0,mark:r,options:{component:t.render,contentAs:"span"},view:i});return s.render(),s},h.createInternalStyleSpec(e,{mark:n})}function Fl(e,t){const n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),r=n.top<o.top,i=n.bottom>o.bottom;return r&&i?"both":r?"top":i?"bottom":"none"}exports.AddBlockButton=At;exports.AddButton=be;exports.AddCommentButton=Vt;exports.AddFileButton=Sn;exports.AddTiptapCommentButton=Lt;exports.AudioBlock=Tn;exports.AudioPreview=jn;exports.AudioToExternalHTML=yn;exports.BasicTextStyleButton=G;exports.BlockColorsItem=Gt;exports.BlockContentWrapper=Q;exports.BlockNoteContext=pe;exports.BlockNoteDefaultUI=pn;exports.BlockNoteViewEditor=vn;exports.BlockNoteViewRaw=fl;exports.BlockTypeSelect=Tt;exports.ColorPickerButton=gn;exports.ColorStyleButton=kt;exports.Comment=ft;exports.Comments=gt;exports.ComponentsContext=Ke;exports.CreateLinkButton=wt;exports.DeleteButton=an;exports.DeleteLinkButton=Ft;exports.DragHandleButton=Kt;exports.DragHandleMenu=$t;exports.EditLinkButton=Pt;exports.EditLinkMenuItems=je;exports.EmbedTab=bt;exports.ExperimentalMobileFormattingToolbarController=Ml;exports.ExtendButton=cn;exports.FigureWithCaption=ae;exports.FileBlock=Ln;exports.FileBlockWrapper=de;exports.FileCaptionButton=vt;exports.FileDeleteButton=Ht;exports.FileDownloadButton=Et;exports.FileNameWithIcon=Bn;exports.FilePanel=Be;exports.FilePanelController=xt;exports.FilePreviewButton=Rt;exports.FileRenameButton=Mt;exports.FileReplaceButton=St;exports.FileToExternalHTML=Vn;exports.FloatingComposer=Xe;exports.FloatingComposerController=Ye;exports.FloatingThreadController=ht;exports.FormattingToolbar=ye;exports.FormattingToolbarController=Nt;exports.GridSuggestionMenuController=tn;exports.GridSuggestionMenuWrapper=en;exports.ImageBlock=_n;exports.ImagePreview=En;exports.ImageToExternalHTML=Rn;exports.InlineContentWrapper=Pn;exports.LinkToolbar=Zt;exports.LinkToolbarController=Ot;exports.LinkWithCaption=K;exports.NestBlockButton=Bt;exports.OpenLinkButton=Dt;exports.ReactAudioBlock=hl;exports.ReactFileBlock=bl;exports.ReactImageBlock=Cl;exports.ReactVideoBlock=wl;exports.RemoveBlockItem=zt;exports.ResizableFileBlockWrapper=Ee;exports.SideMenu=Xt;exports.SideMenuController=Yt;exports.SplitButton=hn;exports.SuggestionMenuController=sn;exports.SuggestionMenuWrapper=ln;exports.TableCellButton=Cn;exports.TableCellMenu=bn;exports.TableCellMergeButton=_t;exports.TableColumnHeaderItem=qt;exports.TableHandle=un;exports.TableHandleMenu=dn;exports.TableHandlesController=xn;exports.TableRowHeaderItem=Wt;exports.TextAlignButton=J;exports.Thread=Me;exports.ThreadsSidebar=jl;exports.ToggleWrapper=Hl;exports.UnnestBlockButton=jt;exports.UploadTab=Ct;exports.VideoBlock=Fn;exports.VideoPreview=In;exports.VideoToExternalHTML=Nn;exports.blockTypeSelectItems=yt;exports.createReactBlockSpec=$;exports.createReactInlineContentSpec=Rl;exports.createReactStyleSpec=Nl;exports.elementOverflow=Fl;exports.getDefaultReactEmojiPickerItems=Jt;exports.getDefaultReactSlashMenuItems=rn;exports.getFormattingToolbarItems=It;exports.getPageBreakReactSlashMenuItems=kl;exports.getReferenceText=Ce;exports.mergeRefs=pt;exports.useActiveStyles=yl;exports.useBlockNote=Qn;exports.useBlockNoteContext=R;exports.useBlockNoteEditor=x;exports.useCloseSuggestionMenuNoItems=Te;exports.useComponentsContext=p;exports.useCreateBlockNote=q;exports.useDictionary=v;exports.useEditorChange=U;exports.useEditorContentOrSelectionChange=F;exports.useEditorForceUpdate=Vl;exports.useEditorSelectionBoundingBox=$e;exports.useEditorSelectionChange=W;exports.useExtendButtonsPositioning=mn;exports.useFocusWithin=El;exports.useGridSuggestionMenuKeyboardNavigation=Qt;exports.useLoadSuggestionMenuItems=Ve;exports.useOnUploadEnd=Hn;exports.useOnUploadStart=Mn;exports.usePrefersColorScheme=kn;exports.useResolveUrl=ce;exports.useSelectedBlocks=y;exports.useSuggestionMenuKeyboardHandler=nn;exports.useSuggestionMenuKeyboardNavigation=on;exports.useTableHandlesPositioning=fn;exports.useThreads=Se;exports.useUIElementPositioning=N;exports.useUIPluginState=L;exports.useUploadLoading=Le;exports.useUser=mt;exports.useUsers=ie;
//# sourceMappingURL=blocknote-react.cjs.map
